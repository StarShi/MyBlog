(function(){var i,b,d,e,a,h,c,f,g;b={};f=this;if((typeof module!=="undefined"&&module!==null)&&module.exports){module.exports=b}else{f.ipaddr=b}c=function(o,n,m,l){var k,j;if(o.length!==n.length){throw new Error("ipaddr: cannot match CIDR for objects with different lengths")}k=0;while(l>0){j=m-l;if(j<0){j=0}if(o[k]>>j!==n[k]>>j){return false}l-=m;k+=1}return true};b.subnetMatch=function(m,l,r){var n,j,q,o,p;if(r==null){r="unicast"}for(q in l){o=l[q];if(o[0]&&!(o[0] instanceof Array)){o=[o]}for(n=0,j=o.length;n<j;n++){p=o[n];if(m.kind()===p[0].kind()){if(m.match.apply(m,p)){return q}}}}return r};b.IPv4=(function(){function j(o){var n,l,m;if(o.length!==4){throw new Error("ipaddr: ipv4 octet count should be 4")}for(n=0,l=o.length;n<l;n++){m=o[n];if(!((0<=m&&m<=255))){throw new Error("ipaddr: ipv4 octet should fit in 8 bits")}}this.octets=o}j.prototype.kind=function(){return"ipv4"};j.prototype.toString=function(){return this.octets.join(".")};j.prototype.toNormalizedString=function(){return this.toString()};j.prototype.toByteArray=function(){return this.octets.slice(0)};j.prototype.match=function(k,l){var m;if(l===void 0){m=k,k=m[0],l=m[1]}if(k.kind()!=="ipv4"){throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one")}return c(this.octets,k.octets,8,l)};j.prototype.SpecialRanges={unspecified:[[new j([0,0,0,0]),8]],broadcast:[[new j([255,255,255,255]),32]],multicast:[[new j([224,0,0,0]),4]],linkLocal:[[new j([169,254,0,0]),16]],loopback:[[new j([127,0,0,0]),8]],carrierGradeNat:[[new j([100,64,0,0]),10]],"private":[[new j([10,0,0,0]),8],[new j([172,16,0,0]),12],[new j([192,168,0,0]),16]],reserved:[[new j([192,0,0,0]),24],[new j([192,0,2,0]),24],[new j([192,88,99,0]),24],[new j([198,51,100,0]),24],[new j([203,0,113,0]),24],[new j([240,0,0,0]),4]]};j.prototype.range=function(){return b.subnetMatch(this,this.SpecialRanges)};j.prototype.toIPv4MappedAddress=function(){return b.IPv6.parse("::ffff:"+(this.toString()))};j.prototype.prefixLengthFromSubnetMask=function(){var q,p,n,l,o,m,r;r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};q=0;o=false;for(p=n=3;n>=0;p=n+=-1){l=this.octets[p];if(l in r){m=r[l];if(o&&m!==0){return null}if(m!==8){o=true}q+=m}else{return null}}return 32-q};return j})();d="(0?\\d+|0x[a-f0-9]+)";e={fourOctet:new RegExp("^"+d+"\\."+d+"\\."+d+"\\."+d+"$","i"),longValue:new RegExp("^"+d+"$","i")};b.IPv4.parser=function(m){var l,o,k,j,n;o=function(p){if(p[0]==="0"&&p[1]!=="x"){return parseInt(p,8)}else{return parseInt(p)}};if(l=m.match(e.fourOctet)){return(function(){var q,p,s,r;s=l.slice(1,6);r=[];for(q=0,p=s.length;q<p;q++){k=s[q];r.push(o(k))}return r})()}else{if(l=m.match(e.longValue)){n=o(l[1]);if(n>4294967295||n<0){throw new Error("ipaddr: address outside defined range")}return((function(){var p,q;q=[];for(j=p=0;p<=24;j=p+=8){q.push((n>>j)&255)}return q})()).reverse()}else{return null}}};b.IPv6=(function(){function j(t,n){var r,p,o,m,q,s;if(t.length===16){this.parts=[];for(r=p=0;p<=14;r=p+=2){this.parts.push((t[r]<<8)|t[r+1])}}else{if(t.length===8){this.parts=t}else{throw new Error("ipaddr: ipv6 part count should be 8 or 16")}}s=this.parts;for(o=0,m=s.length;o<m;o++){q=s[o];if(!((0<=q&&q<=65535))){throw new Error("ipaddr: ipv6 part should fit in 16 bits")}}if(n){this.zoneId=n}}j.prototype.kind=function(){return"ipv6"};j.prototype.toString=function(){var s,o,p,r,n,l,m,q,t;q=(function(){var v,u,x,w;x=this.parts;w=[];for(v=0,u=x.length;v<u;v++){n=x[v];w.push(n.toString(16))}return w}).call(this);o=[];l=function(k){return o.push(k)};m=0;for(p=0,r=q.length;p<r;p++){n=q[p];switch(m){case 0:if(n==="0"){l("")}else{l(n)}m=1;break;case 1:if(n==="0"){m=2}else{l(n)}break;case 2:if(n!=="0"){l("");l(n);m=3}break;case 3:l(n)}}if(m===2){l("");l("")}s=o.join(":");t="";if(this.zoneId){t="%"+this.zoneId}return s+t};j.prototype.toByteArray=function(){var m,n,l,o,p;m=[];p=this.parts;for(n=0,l=p.length;n<l;n++){o=p[n];m.push(o>>8);m.push(o&255)}return m};j.prototype.toNormalizedString=function(){var m,k,l;m=((function(){var o,n,q,p;q=this.parts;p=[];for(o=0,n=q.length;o<n;o++){k=q[o];p.push(k.toString(16))}return p}).call(this)).join(":");l="";if(this.zoneId){l="%"+this.zoneId}return m+l};j.prototype.match=function(k,l){var m;if(l===void 0){m=k,k=m[0],l=m[1]}if(k.kind()!=="ipv6"){throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one")}return c(this.parts,k.parts,16,l)};j.prototype.SpecialRanges={unspecified:[new j([0,0,0,0,0,0,0,0]),128],linkLocal:[new j([65152,0,0,0,0,0,0,0]),10],multicast:[new j([65280,0,0,0,0,0,0,0]),8],loopback:[new j([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new j([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new j([0,0,0,0,0,65535,0,0]),96],rfc6145:[new j([0,0,0,0,65535,0,0,0]),96],rfc6052:[new j([100,65435,0,0,0,0,0,0]),96],"6to4":[new j([8194,0,0,0,0,0,0,0]),16],teredo:[new j([8193,0,0,0,0,0,0,0]),32],reserved:[[new j([8193,3512,0,0,0,0,0,0]),32]]};j.prototype.range=function(){return b.subnetMatch(this,this.SpecialRanges)};j.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"};j.prototype.toIPv4Address=function(){var m,k,l;if(!this.isIPv4MappedAddress()){throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4")}l=this.parts.slice(-2),m=l[0],k=l[1];return new b.IPv4([m>>8,m&255,k>>8,k&255])};j.prototype.prefixLengthFromSubnetMask=function(){var q,p,m,n,o,l,r;r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};q=0;o=false;for(p=m=7;m>=0;p=m+=-1){n=this.parts[p];if(n in r){l=r[n];if(o&&l!==0){return null}if(l!==16){o=true}q+=l}else{return null}}return 128-q};return j})();a="(?:[0-9a-f]+::?)+";g="%[0-9a-z]{1,}";h={zoneIndex:new RegExp(g,"i"),"native":new RegExp("^(::)?("+a+")?([0-9a-f]+)?(::)?("+g+")?$","i"),transitional:new RegExp(("^((?:"+a+")|(?:::)(?:"+a+")?)")+(d+"\\."+d+"\\."+d+"\\."+d)+("("+g+")?$"),"i")};i=function(m,q){var p,k,l,o,n,j;if(m.indexOf("::")!==m.lastIndexOf("::")){return null}j=(m.match(h.zoneIndex)||[])[0];if(j){j=j.substring(1);m=m.replace(/%.+$/,"")}p=0;k=-1;while((k=m.indexOf(":",k+1))>=0){p++}if(m.substr(0,2)==="::"){p--}if(m.substr(-2,2)==="::"){p--}if(p>q){return null}n=q-p;o=":";while(n--){o+="0:"}m=m.replace("::",o);if(m[0]===":"){m=m.slice(1)}if(m[m.length-1]===":"){m=m.slice(0,-1)}q=(function(){var s,r,u,t;u=m.split(":");t=[];for(s=0,r=u.length;s<r;s++){l=u[s];t.push(parseInt(l,16))}return t})();return{parts:q,zoneId:j}};b.IPv6.parser=function(q){var r,n,l,p,m,o,j;if(h["native"].test(q)){return i(q,8)}else{if(p=q.match(h.transitional)){j=p[6]||"";r=i(p[1].slice(0,-1)+j,6);if(r.parts){o=[parseInt(p[2]),parseInt(p[3]),parseInt(p[4]),parseInt(p[5])];for(n=0,l=o.length;n<l;n++){m=o[n];if(!((0<=m&&m<=255))){return null}}r.parts.push(o[0]<<8|o[1]);r.parts.push(o[2]<<8|o[3]);return{parts:r.parts,zoneId:r.zoneId}}}}return null};b.IPv4.isIPv4=b.IPv6.isIPv6=function(j){return this.parser(j)!==null};b.IPv4.isValid=function(j){var k;try{new this(this.parser(j));return true}catch(l){k=l;return false}};b.IPv4.isValidFourPartDecimal=function(j){if(b.IPv4.isValid(j)&&j.match(/^\d+(\.\d+){3}$/)){return true}else{return false}};b.IPv6.isValid=function(j){var m,k;if(typeof j==="string"&&j.indexOf(":")===-1){return false}try{m=this.parser(j);new this(m.parts,m.zoneId);return true}catch(l){k=l;return false}};b.IPv4.parse=function(j){var k;k=this.parser(j);if(k===null){throw new Error("ipaddr: string is not formatted like ip address")}return new this(k)};b.IPv6.parse=function(j){var k;k=this.parser(j);if(k.parts===null){throw new Error("ipaddr: string is not formatted like ip address")}return new this(k.parts,k.zoneId)};b.IPv4.parseCIDR=function(k){var l,j;if(j=k.match(/^(.+)\/(\d+)$/)){l=parseInt(j[2]);if(l>=0&&l<=32){return[this.parse(j[1]),l]}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")};b.IPv4.subnetMaskFromPrefixLength=function(m){var n,l,k;m=parseInt(m);if(m<0||m>32){throw new Error("ipaddr: invalid IPv4 prefix length")}k=[0,0,0,0];l=0;n=Math.floor(m/8);while(l<n){k[l]=255;l++}if(n<4){k[n]=Math.pow(2,m%8)-1<<8-(m%8)}return new this(k)};b.IPv4.broadcastAddressFromCIDR=function(m){var o,l,n,j,k,p;try{o=this.parseCIDR(m);j=o[0].toByteArray();p=this.subnetMaskFromPrefixLength(o[1]).toByteArray();k=[];n=0;while(n<4){k.push(parseInt(j[n],10)|parseInt(p[n],10)^255);n++}return new this(k)}catch(q){l=q;throw new Error("ipaddr: the address does not have IPv4 CIDR format")}};b.IPv4.networkAddressFromCIDR=function(m){var o,l,n,j,k,p;try{o=this.parseCIDR(m);j=o[0].toByteArray();p=this.subnetMaskFromPrefixLength(o[1]).toByteArray();k=[];n=0;while(n<4){k.push(parseInt(j[n],10)&parseInt(p[n],10));n++}return new this(k)}catch(q){l=q;throw new Error("ipaddr: the address does not have IPv4 CIDR format")}};b.IPv6.parseCIDR=function(k){var l,j;if(j=k.match(/^(.+)\/(\d+)$/)){l=parseInt(j[2]);if(l>=0&&l<=128){return[this.parse(j[1]),l]}}throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")};b.isValid=function(j){return b.IPv6.isValid(j)||b.IPv4.isValid(j)};b.parse=function(j){if(b.IPv6.isValid(j)){return b.IPv6.parse(j)}else{if(b.IPv4.isValid(j)){return b.IPv4.parse(j)}else{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")}}};b.parseCIDR=function(j){var k;try{return b.IPv6.parseCIDR(j)}catch(l){k=l;try{return b.IPv4.parseCIDR(j)}catch(l){k=l;throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}};b.fromByteArray=function(j){var k;k=j.length;if(k===4){return new b.IPv4(j)}else{if(k===16){return new b.IPv6(j)}else{throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")}}};b.process=function(j){var k;k=this.parse(j);if(k.kind()==="ipv6"&&k.isIPv4MappedAddress()){return k.toIPv4Address()}else{return k}}}).call(this);