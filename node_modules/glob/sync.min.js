module.exports=globSync;globSync.GlobSync=GlobSync;var fs=require("fs");var rp=require("fs.realpath");var minimatch=require("minimatch");var Minimatch=minimatch.Minimatch;var Glob=require("./glob.js").Glob;var util=require("util");var path=require("path");var assert=require("assert");var isAbsolute=require("path-is-absolute");var common=require("./common.js");var alphasort=common.alphasort;var alphasorti=common.alphasorti;var setopts=common.setopts;var ownProp=common.ownProp;var childrenIgnored=common.childrenIgnored;var isIgnored=common.isIgnored;function globSync(b,a){if(typeof a==="function"||arguments.length===3){throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167")}return new GlobSync(b,a).found}function GlobSync(c,a){if(!c){throw new Error("must provide pattern")}if(typeof a==="function"||arguments.length===3){throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167")}if(!(this instanceof GlobSync)){return new GlobSync(c,a)}setopts(this,c,a);if(this.noprocess){return this}var d=this.minimatch.set.length;this.matches=new Array(d);for(var b=0;b<d;b++){this._process(this.minimatch.set[b],b,false)}this._finish()}GlobSync.prototype._finish=function(){assert(this instanceof GlobSync);if(this.realpath){var a=this;this.matches.forEach(function(c,b){var g=a.matches[b]=Object.create(null);for(var d in c){try{d=a._makeAbs(d);var f=rp.realpathSync(d,a.realpathCache);g[f]=true}catch(e){if(e.syscall==="stat"){g[a._makeAbs(d)]=true}else{throw e}}}})}common.finish(this)};GlobSync.prototype._process=function(g,f,h){assert(this instanceof GlobSync);var c=0;while(typeof g[c]==="string"){c++}var e;switch(c){case g.length:this._processSimple(g.join("/"),f);return;case 0:e=null;break;default:e=g.slice(0,c).join("/");break}var d=g.slice(c);var a;if(e===null){a="."}else{if(isAbsolute(e)||isAbsolute(g.join("/"))){if(!e||!isAbsolute(e)){e="/"+e}a=e}else{a=e}}var i=this._makeAbs(a);if(childrenIgnored(this,a)){return}var b=d[0]===minimatch.GLOBSTAR;if(b){this._processGlobStar(e,a,i,d,f,h)}else{this._processReaddir(e,a,i,d,f,h)}};GlobSync.prototype._processReaddir=function(l,a,t,k,o,s){var j=this._readdir(t,s);if(!j){return}var c=k[0];var h=!!this.minimatch.negate;var d=c._glob;var g=this.dot||d.charAt(0)===".";var r=[];for(var f=0;f<j.length;f++){var p=j[f];if(p.charAt(0)!=="."||g){var b;if(h&&!l){b=!p.match(c)}else{b=p.match(c)}if(b){r.push(p)}}}var n=r.length;if(n===0){return}if(k.length===1&&!this.mark&&!this.stat){if(!this.matches[o]){this.matches[o]=Object.create(null)}for(var f=0;f<n;f++){var p=r[f];if(l){if(l.slice(-1)!=="/"){p=l+"/"+p}else{p=l+p}}if(p.charAt(0)==="/"&&!this.nomount){p=path.join(this.root,p)}this._emitMatch(o,p)}return}k.shift();for(var f=0;f<n;f++){var p=r[f];var q;if(l){q=[l,p]}else{q=[p]}this._process(q.concat(k),o,s)}};GlobSync.prototype._emitMatch=function(b,d){if(isIgnored(this,d)){return}var a=this._makeAbs(d);if(this.mark){d=this._mark(d)}if(this.absolute){d=a}if(this.matches[b][d]){return}if(this.nodir){var f=this.cache[a];if(f==="DIR"||Array.isArray(f)){return}}this.matches[b][d]=true;if(this.stat){this._stat(d)}};GlobSync.prototype._readdirInGlobStar=function(b){if(this.follow){return this._readdir(b,false)}var a;var c;var d;try{c=fs.lstatSync(b)}catch(f){if(f.code==="ENOENT"){return null}}var e=c&&c.isSymbolicLink();this.symlinks[b]=e;if(!e&&c&&!c.isDirectory()){this.cache[b]="FILE"}else{a=this._readdir(b,false)}return a};GlobSync.prototype._readdir=function(b,d){var a;if(d&&!ownProp(this.symlinks,b)){return this._readdirInGlobStar(b)}if(ownProp(this.cache,b)){var f=this.cache[b];if(!f||f==="FILE"){return null}if(Array.isArray(f)){return f}}try{return this._readdirEntries(b,fs.readdirSync(b))}catch(e){this._readdirError(b,e);return null}};GlobSync.prototype._readdirEntries=function(b,a){if(!this.mark&&!this.stat){for(var c=0;c<a.length;c++){var d=a[c];if(b==="/"){d=b+d}else{d=b+"/"+d}this.cache[d]=true}}this.cache[b]=a;return a};GlobSync.prototype._readdirError=function(c,d){switch(d.code){case"ENOTSUP":case"ENOTDIR":var a=this._makeAbs(c);this.cache[a]="FILE";if(a===this.cwdAbs){var b=new Error(d.code+" invalid cwd "+this.cwd);b.path=this.cwd;b.code=d.code;throw b}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(c)]=false;break;default:this.cache[this._makeAbs(c)]=false;if(this.strict){throw d}if(!this.silent){console.error("glob error",d)}break}};GlobSync.prototype._processGlobStar=function(k,b,r,j,m,q){var g=this._readdir(r,q);if(!g){return}var d=j.slice(1);var o=k?[k]:[];var h=o.concat(d);this._process(h,m,false);var l=g.length;var a=this.symlinks[r];if(a&&q){return}for(var f=0;f<l;f++){var n=g[f];if(n.charAt(0)==="."&&!this.dot){continue}var c=o.concat(g[f],d);this._process(c,m,true);var p=o.concat(g[f],j);this._process(p,m,true)}};GlobSync.prototype._processSimple=function(d,b){var c=this._stat(d);if(!this.matches[b]){this.matches[b]=Object.create(null)}if(!c){return}if(d&&isAbsolute(d)&&!this.nomount){var a=/[\/\\]$/.test(d);if(d.charAt(0)==="/"){d=path.join(this.root,d)}else{d=path.resolve(this.root,d);if(a){d+="/"}}}if(process.platform==="win32"){d=d.replace(/\\/g,"/")}this._emitMatch(b,d)};GlobSync.prototype._stat=function(g){var a=this._makeAbs(g);var j=g.slice(-1)==="/";if(g.length>this.maxLength){return false}if(!this.stat&&ownProp(this.cache,a)){var i=this.cache[a];if(Array.isArray(i)){i="DIR"}if(!j||i==="DIR"){return i}if(j&&i==="FILE"){return false}}var e;var d=this.statCache[a];if(!d){var b;try{b=fs.lstatSync(a)}catch(h){if(h&&(h.code==="ENOENT"||h.code==="ENOTDIR")){this.statCache[a]=false;return false}}if(b&&b.isSymbolicLink()){try{d=fs.statSync(a)}catch(h){d=b}}else{d=b}}this.statCache[a]=d;var i=true;if(d){i=d.isDirectory()?"DIR":"FILE"}this.cache[a]=this.cache[a]||i;if(j&&i==="FILE"){return false}return i};GlobSync.prototype._mark=function(a){return common.mark(this,a)};GlobSync.prototype._makeAbs=function(a){return common.makeAbs(this,a)};