/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var debug=require("debug")("express:view");var path=require("path");var fs=require("fs");var dirname=path.dirname;var basename=path.basename;var extname=path.extname;var join=path.join;var resolve=path.resolve;module.exports=View;function View(b,a){var e=a||{};this.defaultEngine=e.defaultEngine;this.ext=extname(b);this.name=b;this.root=e.root;if(!this.ext&&!this.defaultEngine){throw new Error("No default engine was specified and no extension was provided.")}var f=b;if(!this.ext){this.ext=this.defaultEngine[0]!=="."?"."+this.defaultEngine:this.defaultEngine;f+=this.ext}if(!e.engines[this.ext]){var c=this.ext.substr(1);debug('require "%s"',c);var d=require(c).__express;if(typeof d!=="function"){throw new Error('Module "'+c+'" does not provide a view engine.')}e.engines[this.ext]=d}this.engine=e.engines[this.ext];this.path=this.lookup(f)}View.prototype.lookup=function lookup(d){var g;var b=[].concat(this.root);debug('lookup "%s"',d);for(var f=0;f<b.length&&!g;f++){var a=b[f];var h=resolve(a,d);var c=dirname(h);var e=basename(h);g=this.resolve(c,e)}return g};View.prototype.render=function render(a,b){debug('render "%s"',this.path);this.engine(this.path,a,b)};View.prototype.resolve=function resolve(a,b){var d=this.ext;var e=join(a,b);var c=tryStat(e);if(c&&c.isFile()){return e}e=join(a,basename(b,d),"index"+d);c=tryStat(e);if(c&&c.isFile()){return e}};function tryStat(b){debug('stat "%s"',b);try{return fs.statSync(b)}catch(a){return undefined}};