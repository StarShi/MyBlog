/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var pathRegexp=require("path-to-regexp");var debug=require("debug")("express:router:layer");var hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=Layer;function Layer(d,a,b){if(!(this instanceof Layer)){return new Layer(d,a,b)}debug("new %o",d);var c=a||{};this.handle=b;this.name=b.name||"<anonymous>";this.params=undefined;this.path=undefined;this.regexp=pathRegexp(d,this.keys=[],c);this.regexp.fast_star=d==="*";this.regexp.fast_slash=d==="/"&&c.end===false}Layer.prototype.handle_error=function handle_error(a,f,b,d){var c=this.handle;if(c.length!==4){return d(a)}try{c(a,f,b,d)}catch(e){d(e)}};Layer.prototype.handle_request=function handle(e,a,c){var b=this.handle;if(b.length>3){return c()}try{b(e,a,c)}catch(d){c(d)}};Layer.prototype.match=function match(e){var a;if(e!=null){if(this.regexp.fast_slash){this.params={};this.path="";return true}if(this.regexp.fast_star){this.params={"0":decode_param(e)};this.path=e;return true}a=this.regexp.exec(e)}if(!a){this.params=undefined;this.path=undefined;return false}this.params={};this.path=a[0];var d=this.keys;var g=this.params;for(var c=1;c<a.length;c++){var b=d[c-1];var h=b.name;var f=decode_param(a[c]);if(f!==undefined||!(hasOwnProperty.call(g,h))){g[h]=f}}return true};function decode_param(b){if(typeof b!=="string"||b.length===0){return b}try{return decodeURIComponent(b)}catch(a){if(a instanceof URIError){a.message="Failed to decode param '"+b+"'";a.status=a.statusCode=400}throw a}};