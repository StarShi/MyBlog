/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var debug=require("debug")("express:router:route");var flatten=require("array-flatten");var Layer=require("./layer");var methods=require("methods");var slice=Array.prototype.slice;var toString=Object.prototype.toString;module.exports=Route;function Route(a){this.path=a;this.stack=[];debug("new %o",a);this.methods={}}Route.prototype._handles_method=function _handles_method(b){if(this.methods._all){return true}var a=b.toLowerCase();if(a==="head"&&!this.methods.head){a="get"}return Boolean(this.methods[a])};Route.prototype._options=function _options(){var a=Object.keys(this.methods);if(this.methods.get&&!this.methods.head){a.push("head")}for(var b=0;b<a.length;b++){a[b]=a[b].toUpperCase()}return a};Route.prototype.dispatch=function dispatch(f,d,c){var b=0;var a=this.stack;if(a.length===0){return c()}var g=f.method.toLowerCase();if(g==="head"&&!this.methods.head){g="get"}f.route=this;e();function e(i){if(i&&i==="route"){return c()}if(i&&i==="router"){return c(i)}var h=a[b++];if(!h){return c(i)}if(h.method&&h.method!==g){return e(i)}if(i){h.handle_error(i,f,d,e)}else{h.handle_request(f,d,e)}}};Route.prototype.all=function all(){var c=flatten(slice.call(arguments));for(var b=0;b<c.length;b++){var e=c[b];if(typeof e!=="function"){var d=toString.call(e);var f="Route.all() requires a callback function but got a "+d;throw new TypeError(f)}var a=Layer("/",{},e);a.method=undefined;this.methods._all=true;this.stack.push(a)}return this};methods.forEach(function(a){Route.prototype[a]=function(){var d=flatten(slice.call(arguments));for(var c=0;c<d.length;c++){var f=d[c];if(typeof f!=="function"){var e=toString.call(f);var g="Route."+a+"() requires a callback function but got a "+e;throw new Error(g)}debug("%s %o",a,this.path);var b=Layer("/",{},f);b.method=a;this.methods[a]=true;this.stack.push(b)}return this}});