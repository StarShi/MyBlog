/*!
 * serve-static
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * Copyright(c) 2014-2016 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var encodeUrl=require("encodeurl");var escapeHtml=require("escape-html");var parseUrl=require("parseurl");var resolve=require("path").resolve;var send=require("send");var url=require("url");module.exports=serveStatic;module.exports.mime=send.mime;function serveStatic(a,b){if(!a){throw new TypeError("root path required")}if(typeof a!=="string"){throw new TypeError("root path must be a string")}var d=Object.create(b||null);var e=d.fallthrough!==false;var h=d.redirect!==false;var g=d.setHeaders;if(g&&typeof g!=="function"){throw new TypeError("option setHeaders must be function")}d.maxage=d.maxage||d.maxAge||0;d.root=resolve(a);var f=h?createRedirectDirectoryListener():createNotFoundDirectoryListener();return function c(n,l,k){if(n.method!=="GET"&&n.method!=="HEAD"){if(e){return k()}l.statusCode=405;l.setHeader("Allow","GET, HEAD");l.setHeader("Content-Length","0");l.end();return}var i=!e;var o=parseUrl.original(n);var q=parseUrl(n).pathname;if(q==="/"&&o.pathname.substr(-1)!=="/"){q=""}var p=send(n,q,d);p.on("directory",f);if(g){p.on("headers",g)}if(e){p.on("file",function j(){i=true})}p.on("error",function m(r){if(i||!(r.statusCode<500)){k(r);return}k()});p.pipe(l)}}function collapseLeadingSlashes(b){for(var a=0;a<b.length;a++){if(b.charCodeAt(a)!==47){break}}return a>1?"/"+b.substr(a):b}function createHtmlDocument(b,a){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="utf-8">\n<title>'+b+"</title>\n</head>\n<body>\n<pre>"+a+"</pre>\n</body>\n"}function createNotFoundDirectoryListener(){return function a(){this.error(404)}}function createRedirectDirectoryListener(){return function a(b){if(this.hasTrailingSlash()){this.error(404);return}var c=parseUrl.original(this.req);c.path=null;c.pathname=collapseLeadingSlashes(c.pathname+"/");var e=encodeUrl(url.format(c));var d=createHtmlDocument("Redirecting",'Redirecting to <a href="'+escapeHtml(e)+'">'+escapeHtml(e)+"</a>");b.statusCode=301;b.setHeader("Content-Type","text/html; charset=UTF-8");b.setHeader("Content-Length",Buffer.byteLength(d));b.setHeader("Content-Security-Policy","default-src 'self'");b.setHeader("X-Content-Type-Options","nosniff");b.setHeader("Location",e);b.end(d)}};