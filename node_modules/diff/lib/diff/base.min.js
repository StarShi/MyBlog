"use strict";exports.__esModule=true;exports["default"]=Diff;function Diff(){}Diff.prototype={diff:function diff(h,k){var o=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var m=o.callback;if(typeof o==="function"){m=o;o={}}this.options=o;var n=this;function f(p){if(m){setTimeout(function(){m(undefined,p)},0);return true}else{return p}}h=this.castInput(h);k=this.castInput(k);h=this.removeEmpty(this.tokenize(h));k=this.removeEmpty(this.tokenize(k));var g=k.length,b=h.length;var a=1;var l=g+b;var j=[{newPos:-1,components:[]}];var d=this.extractCommon(j[0],k,h,0);if(j[0].newPos+1>=g&&d+1>=b){return f([{value:this.join(k),count:k.length}])}function e(){for(var r=-1*a;r<=a;r+=2){var v=void 0;var q=j[r-1],p=j[r+1],u=(p?p.newPos:0)-r;if(q){j[r-1]=undefined}var s=q&&q.newPos+1<g,t=p&&0<=u&&u<b;if(!s&&!t){j[r]=undefined;continue}if(!s||t&&q.newPos<p.newPos){v=clonePath(p);n.pushComponent(v.components,undefined,true)}else{v=q;v.newPos++;n.pushComponent(v.components,true,undefined)}u=n.extractCommon(v,k,h,r);if(v.newPos+1>=g&&u+1>=b){return f(buildValues(n,v.components,k,h,n.useLongestToken))}else{j[r]=v}}a++}if(m){(function c(){setTimeout(function(){if(a>l){return m()}if(!e()){c()}},0)})()}else{while(a<=l){var i=e();if(i){return i}}}},pushComponent:function pushComponent(c,a,d){var b=c[c.length-1];if(b&&b.added===a&&b.removed===d){c[c.length-1]={count:b.count+1,added:a,removed:d}}else{c.push({count:1,added:a,removed:d})}},extractCommon:function extractCommon(i,e,d,h){var c=e.length,a=d.length,g=i.newPos,b=g-h,f=0;while(g+1<c&&b+1<a&&this.equals(e[g+1],d[b+1])){g++;b++;f++}if(f){i.components.push({count:f})}i.newPos=g;return b},equals:function equals(b,a){return b===a},removeEmpty:function removeEmpty(c){var a=[];for(var b=0;b<c.length;b++){if(c[b]){a.push(c[b])}}return a},castInput:function castInput(a){return a},tokenize:function tokenize(a){return a.split("")},join:function join(a){return a.join("")}};function buildValues(m,g,i,h,d){var f=0,b=g.length,j=0,c=0;for(;f<b;f++){var k=g[f];if(!k.removed){if(!k.added&&d){var l=i.slice(j,j+k.count);l=l.map(function(p,o){var n=h[c+o];return n.length>p.length?n:p});k.value=m.join(l)}else{k.value=m.join(i.slice(j,j+k.count))}j+=k.count;if(!k.added){c+=k.count}}else{k.value=m.join(h.slice(c,c+k.count));c+=k.count;if(f&&g[f-1].added){var e=g[f-1];g[f-1]=g[f];g[f]=e}}}var a=g[b-1];if(b>1&&(a.added||a.removed)&&m.equals("",a.value)){g[b-2].value+=a.value;g.pop()}return g}function clonePath(a){return{newPos:a.newPos,components:a.components.slice(0)}};