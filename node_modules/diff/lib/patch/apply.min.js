"use strict";exports.__esModule=true;exports.applyPatch=applyPatch;exports.applyPatches=applyPatches;var _parse=require("./parse");var _distanceIterator=require("../util/distance-iterator");var _distanceIterator2=_interopRequireDefault(_distanceIterator);function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}function applyPatch(t,p){var e=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];if(typeof p==="string"){p=(0,_parse.parsePatch)(p)}if(Array.isArray(p)){if(p.length>1){throw new Error("applyPatch only works with a single input.")}p=p[0]}var c=t.split(/\r\n|[\n\v\f\r\x85]/),k=t.match(/\r\n|[\n\v\f\r\x85]/g)||[],m=p.hunks,s=e.compareLine||function(i,j,G,H){return(j===H)},F=0,q=e.fuzzFactor||0,A=0,g=0,y=void 0,v=void 0;function B(I,K){for(var H=0;H<I.lines.length;H++){var i=I.lines[H],G=i[0],J=i.substr(1);if(G===" "||G==="-"){if(!s(K+1,c[K],G,J)){F++;if(F>q){return false}}K++}}return true}for(var z=0;z<m.length;z++){var l=m[z],a=c.length-l.oldLines,D=0,u=g+l.oldStart-1;var r=(0,_distanceIterator2["default"])(u,A,a);for(;D!==undefined;D=r()){if(B(l,u+D)){l.offset=g+=D;break}}if(D===undefined){return false}A=l.offset+l.oldStart+l.oldLines}for(var d=0;d<m.length;d++){var E=m[d],f=E.offset+E.newStart-1;if(E.newLines==0){f++}for(var x=0;x<E.lines.length;x++){var o=E.lines[x],n=o[0],w=o.substr(1),C=E.linedelimiters[x];if(n===" "){f++}else{if(n==="-"){c.splice(f,1);k.splice(f,1)}else{if(n==="+"){c.splice(f,0,w);k.splice(f,0,C);f++}else{if(n==="\\"){var h=E.lines[x-1]?E.lines[x-1][0]:null;if(h==="+"){y=true}else{if(h==="-"){v=true}}}}}}}}if(y){while(!c[c.length-1]){c.pop();k.pop()}}else{if(v){c.push("");k.push("\n")}}for(var b=0;b<c.length-1;b++){c[b]=c[b]+k[b]}return c.join("")}function applyPatches(d,c){if(typeof d==="string"){d=(0,_parse.parsePatch)(d)}var b=0;function a(){var e=d[b++];if(!e){return c.complete()}c.loadFile(e,function(g,h){if(g){return c.complete(g)}var f=applyPatch(h,e,c);c.patched(e,f,function(i){if(i){return c.complete(i)}a()})})}a()};