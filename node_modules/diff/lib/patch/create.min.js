"use strict";exports.__esModule=true;exports.structuredPatch=structuredPatch;exports.createTwoFilesPatch=createTwoFilesPatch;exports.createPatch=createPatch;var _line=require("../diff/line");function _toConsumableArray(a){if(Array.isArray(a)){for(var c=0,b=Array(a.length);c<a.length;c++){b[c]=a[c]}return b}else{return Array.from(a)}}function structuredPatch(o,h,f,n,j,m,r){if(!r){r={}}if(typeof r.context==="undefined"){r.context=4}var p=(0,_line.diffLines)(f,n,r);p.push({value:"",lines:[]});function e(i){return i.map(function(s){return" "+s})}var b=[];var c=0,l=0,q=[],a=1,k=1;var d=function d(w){var y=p[w],C=y.lines||y.value.replace(/\n$/,"").split("\n");y.lines=C;if(y.added||y.removed){var s;if(!c){var u=p[w-1];c=a;l=k;if(u){q=r.context>0?e(u.lines.slice(-r.context)):[];c-=q.length;l-=q.length}}(s=q).push.apply(s,_toConsumableArray(C.map(function(i){return(y.added?"+":"-")+i})));if(y.added){k+=C.length}else{a+=C.length}}else{if(c){if(C.length<=r.context*2&&w<p.length-2){var A;(A=q).push.apply(A,_toConsumableArray(e(C)))}else{var z;var t=Math.min(C.length,r.context);(z=q).push.apply(z,_toConsumableArray(e(C.slice(0,t))));var v={oldStart:c,oldLines:a-c+t,newStart:l,newLines:k-l+t,lines:q};if(w>=p.length-2&&C.length<=r.context){var x=/\n$/.test(f);var B=/\n$/.test(n);if(C.length==0&&!x){q.splice(v.oldLines,0,"\\ No newline at end of file")}else{if(!x||!B){q.push("\\ No newline at end of file")}}}b.push(v);c=0;l=0;q=[]}}a+=C.length;k+=C.length}};for(var g=0;g<p.length;g++){d(g)}return{oldFileName:o,newFileName:h,oldHeader:j,newHeader:m,hunks:b}}function createTwoFilesPatch(j,d,a,h,e,g,l){var k=structuredPatch(j,d,a,h,e,g,l);var f=[];if(j==d){f.push("Index: "+j)}f.push("===================================================================");f.push("--- "+k.oldFileName+(typeof k.oldHeader==="undefined"?"":"\t"+k.oldHeader));f.push("+++ "+k.newFileName+(typeof k.newHeader==="undefined"?"":"\t"+k.newHeader));for(var c=0;c<k.hunks.length;c++){var b=k.hunks[c];f.push("@@ -"+b.oldStart+","+b.oldLines+" +"+b.newStart+","+b.newLines+" @@");f.push.apply(f,b.lines)}return f.join("\n")+"\n"}function createPatch(f,b,d,e,a,c){return createTwoFilesPatch(f,f,b,d,e,a,c)};