"use strict";exports.__esModule=true;exports.parsePatch=parsePatch;function parsePatch(b){var j=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var f=b.split(/\r\n|[\n\v\f\r\x85]/),h=b.match(/\r\n|[\n\v\f\r\x85]/g)||[],g=[],e=0;function d(){var k={};g.push(k);while(e<f.length){var i=f[e];if(/^(\-\-\-|\+\+\+|@@)\s/.test(i)){break}var m=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(i);if(m){k.index=m[1]}e++}a(k);a(k);k.hunks=[];while(e<f.length){var l=f[e];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(l)){break}else{if(/^@@/.test(l)){k.hunks.push(c())}else{if(l&&j.strict){throw new Error("Unknown line "+(e+1)+" "+JSON.stringify(l))}else{e++}}}}}function a(k){var l=/^(---|\+\+\+)\s+([\S ]*)(?:\t(.*?)\s*)?$/;var i=l.exec(f[e]);if(i){var m=i[1]==="---"?"old":"new";k[m+"FileName"]=i[2];k[m+"Header"]=i[3];e++}}function c(){var l=e,n=f[e++],p=n.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/);var k={oldStart:+p[1],oldLines:+p[2]||1,newStart:+p[3],newLines:+p[4]||1,lines:[],linedelimiters:[]};var m=0,o=0;for(;e<f.length;e++){if(f[e].indexOf("--- ")===0&&e+2<f.length&&f[e+1].indexOf("+++ ")===0&&f[e+2].indexOf("@@")===0){break}var i=f[e][0];if(i==="+"||i==="-"||i===" "||i==="\\"){k.lines.push(f[e]);k.linedelimiters.push(h[e]||"\n");if(i==="+"){m++}else{if(i==="-"){o++}else{if(i===" "){m++;o++}}}}else{break}}if(!m&&k.newLines===1){k.newLines=0}if(!o&&k.oldLines===1){k.oldLines=0}if(j.strict){if(m!==k.newLines){throw new Error("Added line count did not match for hunk at line "+(l+1))}if(o!==k.oldLines){throw new Error("Removed line count did not match for hunk at line "+(l+1))}}return k}while(e<f.length){d()}return g};