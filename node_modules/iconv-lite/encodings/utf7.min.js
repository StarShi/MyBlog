"use strict";var Buffer=require("buffer").Buffer;exports.utf7=Utf7Codec;exports.unicode11utf7="utf7";function Utf7Codec(b,a){this.iconv=a}Utf7Codec.prototype.encoder=Utf7Encoder;Utf7Codec.prototype.decoder=Utf7Decoder;Utf7Codec.prototype.bomAware=true;var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;function Utf7Encoder(a,b){this.iconv=b.iconv}Utf7Encoder.prototype.write=function(a){return new Buffer(a.replace(nonDirectChars,function(b){return"+"+(b==="+"?"":this.iconv.encode(b,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))};Utf7Encoder.prototype.end=function(){};function Utf7Decoder(a,b){this.iconv=b.iconv;this.inBase64=false;this.base64Accum=""}var base64Regex=/[A-Za-z0-9\/+]/;var base64Chars=[];for(var i=0;i<256;i++){base64Chars[i]=base64Regex.test(String.fromCharCode(i))}var plusChar="+".charCodeAt(0),minusChar="-".charCodeAt(0),andChar="&".charCodeAt(0);Utf7Decoder.prototype.write=function(d){var g="",b=0,h=this.inBase64,c=this.base64Accum;for(var f=0;f<d.length;f++){if(!h){if(d[f]==plusChar){g+=this.iconv.decode(d.slice(b,f),"ascii");b=f+1;h=true}}else{if(!base64Chars[d[f]]){if(f==b&&d[f]==minusChar){g+="+"}else{var e=c+d.slice(b,f).toString();g+=this.iconv.decode(new Buffer(e,"base64"),"utf16-be")}if(d[f]!=minusChar){f--}b=f+1;h=false;c=""}}}if(!h){g+=this.iconv.decode(d.slice(b),"ascii")}else{var e=c+d.slice(b).toString();var a=e.length-(e.length%8);c=e.slice(a);e=e.slice(0,a);g+=this.iconv.decode(new Buffer(e,"base64"),"utf16-be")}this.inBase64=h;this.base64Accum=c;return g};Utf7Decoder.prototype.end=function(){var a="";if(this.inBase64&&this.base64Accum.length>0){a=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")}this.inBase64=false;this.base64Accum="";return a};exports.utf7imap=Utf7IMAPCodec;function Utf7IMAPCodec(b,a){this.iconv=a}Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder;Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder;Utf7IMAPCodec.prototype.bomAware=true;function Utf7IMAPEncoder(a,b){this.iconv=b.iconv;this.inBase64=false;this.base64Accum=new Buffer(6);this.base64AccumIdx=0}Utf7IMAPEncoder.prototype.write=function(f){var d=this.inBase64,a=this.base64Accum,e=this.base64AccumIdx,b=new Buffer(f.length*5+10),h=0;for(var c=0;c<f.length;c++){var g=f.charCodeAt(c);if(32<=g&&g<=126){if(d){if(e>0){h+=b.write(a.slice(0,e).toString("base64").replace(/\//g,",").replace(/=+$/,""),h);e=0}b[h++]=minusChar;d=false}if(!d){b[h++]=g;if(g===andChar){b[h++]=minusChar}}}else{if(!d){b[h++]=andChar;d=true}if(d){a[e++]=g>>8;a[e++]=g&255;if(e==a.length){h+=b.write(a.toString("base64").replace(/\//g,","),h);e=0}}}}this.inBase64=d;this.base64AccumIdx=e;return b.slice(0,h)};Utf7IMAPEncoder.prototype.end=function(){var a=new Buffer(10),b=0;if(this.inBase64){if(this.base64AccumIdx>0){b+=a.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),b);this.base64AccumIdx=0}a[b++]=minusChar;this.inBase64=false}return a.slice(0,b)};function Utf7IMAPDecoder(a,b){this.iconv=b.iconv;this.inBase64=false;this.base64Accum=""}var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=true;Utf7IMAPDecoder.prototype.write=function(d){var g="",b=0,h=this.inBase64,c=this.base64Accum;for(var f=0;f<d.length;f++){if(!h){if(d[f]==andChar){g+=this.iconv.decode(d.slice(b,f),"ascii");b=f+1;h=true}}else{if(!base64IMAPChars[d[f]]){if(f==b&&d[f]==minusChar){g+="&"}else{var e=c+d.slice(b,f).toString().replace(/,/g,"/");g+=this.iconv.decode(new Buffer(e,"base64"),"utf16-be")}if(d[f]!=minusChar){f--}b=f+1;h=false;c=""}}}if(!h){g+=this.iconv.decode(d.slice(b),"ascii")}else{var e=c+d.slice(b).toString().replace(/,/g,"/");var a=e.length-(e.length%8);c=e.slice(a);e=e.slice(0,a);g+=this.iconv.decode(new Buffer(e,"base64"),"utf16-be")}this.inBase64=h;this.base64Accum=c;return g};Utf7IMAPDecoder.prototype.end=function(){var a="";if(this.inBase64&&this.base64Accum.length>0){a=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")}this.inBase64=false;this.base64Accum="";return a};