"use strict";var Buffer=require("buffer").Buffer;exports.utf16be=Utf16BECodec;function Utf16BECodec(){}Utf16BECodec.prototype.encoder=Utf16BEEncoder;Utf16BECodec.prototype.decoder=Utf16BEDecoder;Utf16BECodec.prototype.bomAware=true;function Utf16BEEncoder(){}Utf16BEEncoder.prototype.write=function(d){var a=new Buffer(d,"ucs2");for(var c=0;c<a.length;c+=2){var b=a[c];a[c]=a[c+1];a[c+1]=b}return a};Utf16BEEncoder.prototype.end=function(){};function Utf16BEDecoder(){this.overflowByte=-1}Utf16BEDecoder.prototype.write=function(b){if(b.length==0){return""}var d=new Buffer(b.length+1),c=0,a=0;if(this.overflowByte!==-1){d[0]=b[0];d[1]=this.overflowByte;c=1;a=2}for(;c<b.length-1;c+=2,a+=2){d[a]=b[c+1];d[a+1]=b[c]}this.overflowByte=(c==b.length-1)?b[b.length-1]:-1;return d.slice(0,a).toString("ucs2")};Utf16BEDecoder.prototype.end=function(){};exports.utf16=Utf16Codec;function Utf16Codec(b,a){this.iconv=a}Utf16Codec.prototype.encoder=Utf16Encoder;Utf16Codec.prototype.decoder=Utf16Decoder;function Utf16Encoder(a,b){a=a||{};if(a.addBOM===undefined){a.addBOM=true}this.encoder=b.iconv.getEncoder("utf-16le",a)}Utf16Encoder.prototype.write=function(a){return this.encoder.write(a)};Utf16Encoder.prototype.end=function(){return this.encoder.end()};function Utf16Decoder(a,b){this.decoder=null;this.initialBytes=[];this.initialBytesLen=0;this.options=a||{};this.iconv=b.iconv}Utf16Decoder.prototype.write=function(a){if(!this.decoder){this.initialBytes.push(a);this.initialBytesLen+=a.length;if(this.initialBytesLen<16){return""}var a=Buffer.concat(this.initialBytes),b=detectEncoding(a,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(b,this.options);this.initialBytes.length=this.initialBytesLen=0}return this.decoder.write(a)};Utf16Decoder.prototype.end=function(){if(!this.decoder){var b=Buffer.concat(this.initialBytes),d=detectEncoding(b,this.options.defaultEncoding);this.decoder=this.iconv.getDecoder(d,this.options);var c=this.decoder.write(b),a=this.decoder.end();return a?(c+a):c}return this.decoder.end()};function detectEncoding(c,e){var b=e||"utf-16le";if(c.length>=2){if(c[0]==254&&c[1]==255){b="utf-16be"}else{if(c[0]==255&&c[1]==254){b="utf-16le"}else{var f=0,g=0,a=Math.min(c.length-(c.length%2),64);for(var d=0;d<a;d+=2){if(c[d]===0&&c[d+1]!==0){g++}if(c[d]!==0&&c[d+1]===0){f++}}if(g>f){b="utf-16be"}else{if(g<f){b="utf-16le"}}}}}return b};