var fs=require("fs");var os=require("os");var path=require("path");var crypto=require("crypto");var mkdirp=require("mkdirp");function getFilename(c,b,a){crypto.pseudoRandomBytes(16,function(e,d){a(e,e?undefined:d.toString("hex"))})}function getDestination(c,b,a){a(null,os.tmpdir())}function DiskStorage(a){this.getFilename=(a.filename||getFilename);if(typeof a.destination==="string"){mkdirp.sync(a.destination);this.getDestination=function(d,c,b){b(null,a.destination)}}else{this.getDestination=(a.destination||getDestination)}}DiskStorage.prototype._handleFile=function _handleFile(d,b,a){var c=this;c.getDestination(d,b,function(f,e){if(f){return a(f)}c.getFilename(d,b,function(j,h){if(j){return a(j)}var g=path.join(e,h);var i=fs.createWriteStream(g);b.stream.pipe(i);i.on("error",a);i.on("finish",function(){a(null,{destination:e,filename:h,path:g,size:i.bytesWritten})})})})};DiskStorage.prototype._removeFile=function _removeFile(c,b,a){var d=b.path;delete b.destination;delete b.filename;delete b.path;fs.unlink(d,a)};module.exports=function(a){return new DiskStorage(a)};