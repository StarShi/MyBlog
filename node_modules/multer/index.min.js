var makeError=require("./lib/make-error");var makeMiddleware=require("./lib/make-middleware");var diskStorage=require("./storage/disk");var memoryStorage=require("./storage/memory");function allowAll(c,b,a){a(null,true)}function Multer(a){if(a.storage){this.storage=a.storage}else{if(a.dest){this.storage=diskStorage({destination:a.dest})}else{this.storage=memoryStorage()}}this.limits=a.limits;this.preservePath=a.preservePath;this.fileFilter=a.fileFilter||allowAll}Multer.prototype._makeMiddleware=function(b,c){function a(){var f=this.fileFilter;var d=Object.create(null);b.forEach(function(g){if(typeof g.maxCount==="number"){d[g.name]=g.maxCount}else{d[g.name]=Infinity}});function e(i,h,g){if((d[h.fieldname]||0)<=0){return g(makeError("LIMIT_UNEXPECTED_FILE",h.fieldname))}d[h.fieldname]-=1;f(i,h,g)}return{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:e,fileStrategy:c}}return makeMiddleware(a.bind(this))};Multer.prototype.single=function(a){return this._makeMiddleware([{name:a,maxCount:1}],"VALUE")};Multer.prototype.array=function(a,b){return this._makeMiddleware([{name:a,maxCount:b}],"ARRAY")};Multer.prototype.fields=function(a){return this._makeMiddleware(a,"OBJECT")};Multer.prototype.none=function(){return this._makeMiddleware([],"NONE")};Multer.prototype.any=function(){function a(){return{limits:this.limits,preservePath:this.preservePath,storage:this.storage,fileFilter:this.fileFilter,fileStrategy:"ARRAY"}}return makeMiddleware(a.bind(this))};function multer(a){if(a===undefined){return new Multer({})}if(typeof a==="object"&&a!==null){return new Multer(a)}throw new TypeError("Expected object for argument options")}module.exports=multer;module.exports.diskStorage=diskStorage;module.exports.memoryStorage=memoryStorage;