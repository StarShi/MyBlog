var assert=require("assert");require("../node_modules/formidable/test/common");var multipartParser=require("../node_modules/formidable/lib/multipart_parser"),MultipartParser=multipartParser.MultipartParser,parser=new MultipartParser(),boundary="-----------------------------168072824752491622650073",mb=100,buffer=createMultipartBuffer(boundary,mb*1024*1024),callbacks={partBegin:-1,partEnd:-1,headerField:-1,headerValue:-1,partData:-1,end:-1};parser.initWithBoundary(boundary);parser.onHeaderField=function(){callbacks.headerField++};parser.onHeaderValue=function(){callbacks.headerValue++};parser.onPartBegin=function(){callbacks.partBegin++};parser.onPartData=function(){callbacks.partData++};parser.onPartEnd=function(){callbacks.partEnd++};parser.onEnd=function(){callbacks.end++};var start=+new Date(),nparsed=parser.write(buffer),duration=+new Date-start,mbPerSec=(mb/(duration/1000)).toFixed(2);console.log(mbPerSec+" mb/sec");function createMultipartBuffer(e,d){var c="--"+e+'\r\ncontent-disposition: form-data; name="field1"\r\n\r\n',b="\r\n--"+e+"--\r\n",a=new Buffer(d);a.write(c,"ascii",0);a.write(b,"ascii",a.length-b.length);return a}process.on("exit",function(){});