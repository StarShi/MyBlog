"use strict";var Base=require("./base");var utils=require("../utils");var inherits=utils.inherits;var fs=require("fs");var escape=utils.escape;var mkdirp=require("mkdirp");var path=require("path");var Date=global.Date;var setTimeout=global.setTimeout;var setInterval=global.setInterval;var clearTimeout=global.clearTimeout;var clearInterval=global.clearInterval;exports=module.exports=XUnit;function XUnit(e,b){Base.call(this,e);var c=this.stats;var d=[];var a=this;if(b&&b.reporterOptions&&b.reporterOptions.output){if(!fs.createWriteStream){throw new Error("file output not supported in browser")}mkdirp.sync(path.dirname(b.reporterOptions.output));a.fileStream=fs.createWriteStream(b.reporterOptions.output)}e.on("pending",function(f){d.push(f)});e.on("pass",function(f){d.push(f)});e.on("fail",function(f){d.push(f)});e.on("end",function(){a.write(tag("testsuite",{name:"Mocha Tests",tests:c.tests,failures:c.failures,errors:c.failures,skipped:c.tests-c.failures-c.passes,timestamp:(new Date()).toUTCString(),time:(c.duration/1000)||0},false));d.forEach(function(f){a.test(f)});a.write("</testsuite>")})}inherits(XUnit,Base);XUnit.prototype.done=function(b,a){if(this.fileStream){this.fileStream.end(function(){a(b)})}else{a(b)}};XUnit.prototype.write=function(a){if(this.fileStream){this.fileStream.write(a+"\n")}else{if(typeof process==="object"&&process.stdout){process.stdout.write(a+"\n")}else{console.log(a)}}};XUnit.prototype.test=function(c){var a={classname:c.parent.fullTitle(),name:c.title,time:(c.duration/1000)||0};if(c.state==="failed"){var b=c.err;this.write(tag("testcase",a,false,tag("failure",{},false,escape(b.message)+"\n"+escape(b.stack))))}else{if(c.isPending()){this.write(tag("testcase",a,false,tag("skipped",{},true)))}else{this.write(tag("testcase",a,true))}}};function tag(d,c,h,f){var b=h?"/>":">";var g=[];var a;for(var e in c){if(Object.prototype.hasOwnProperty.call(c,e)){g.push(e+'="'+escape(c[e])+'"')}}a="<"+d+(g.length?" "+g.join(" "):"")+b;if(f){a+=f+"</"+d+b}return a};