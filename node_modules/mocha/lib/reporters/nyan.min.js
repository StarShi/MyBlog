"use strict";var Base=require("./base");var inherits=require("../utils").inherits;exports=module.exports=NyanCat;function NyanCat(d){Base.call(this,d);var a=this;var c=Base.window.width*0.75|0;var b=this.nyanCatWidth=11;this.colorIndex=0;this.numberOfLines=4;this.rainbowColors=a.generateColors();this.scoreboardWidth=5;this.tick=0;this.trajectories=[[],[],[],[]];this.trajectoryWidthMax=(c-b);d.on("start",function(){Base.cursor.hide();a.draw()});d.on("pending",function(){a.draw()});d.on("pass",function(){a.draw()});d.on("fail",function(){a.draw()});d.on("end",function(){Base.cursor.show();for(var e=0;e<a.numberOfLines;e++){write("\n")}a.epilogue()})}inherits(NyanCat,Base);NyanCat.prototype.draw=function(){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat();this.tick=!this.tick};NyanCat.prototype.drawScoreboard=function(){var b=this.stats;function a(c,d){write(" ");write(Base.color(c,d));write("\n")}a("green",b.passes);a("fail",b.failures);a("pending",b.pending);write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.appendRainbow=function(){var d=this.tick?"_":"-";var a=this.rainbowify(d);for(var c=0;c<this.numberOfLines;c++){var b=this.trajectories[c];if(b.length>=this.trajectoryWidthMax){b.shift()}b.push(a)}};NyanCat.prototype.drawRainbow=function(){var a=this;this.trajectories.forEach(function(b){write("\u001b["+a.scoreboardWidth+"C");write(b.join(""));write("\n")});this.cursorUp(this.numberOfLines)};NyanCat.prototype.drawNyanCat=function(){var b=this;var a=this.scoreboardWidth+this.trajectories[0].length;var e="\u001b["+a+"C";var d="";write(e);write("_,------,");write("\n");write(e);d=b.tick?"  ":"   ";write("_|"+d+"/\\_/\\ ");write("\n");write(e);d=b.tick?"_":"__";var c=b.tick?"~":"^";write(c+"|"+d+this.face()+" ");write("\n");write(e);d=b.tick?" ":"  ";write(d+'""  "" ');write("\n");this.cursorUp(this.numberOfLines)};NyanCat.prototype.face=function(){var a=this.stats;if(a.failures){return"( x .x)"}else{if(a.pending){return"( o .o)"}else{if(a.passes){return"( ^ .^)"}}}return"( - .-)"};NyanCat.prototype.cursorUp=function(a){write("\u001b["+a+"A")};NyanCat.prototype.cursorDown=function(a){write("\u001b["+a+"B")};NyanCat.prototype.generateColors=function(){var c=[];for(var d=0;d<(6*7);d++){var h=Math.floor(Math.PI/3);var j=(d*(1/6));var f=Math.floor(3*Math.sin(j)+3);var e=Math.floor(3*Math.sin(j+2*h)+3);var a=Math.floor(3*Math.sin(j+4*h)+3);c.push(36*f+6*e+a+16)}return c};NyanCat.prototype.rainbowify=function(b){if(!Base.useColors){return b}var a=this.rainbowColors[this.colorIndex%this.rainbowColors.length];this.colorIndex+=1;return"\u001b[38;5;"+a+"m"+b+"\u001b[0m"};function write(a){process.stdout.write(a)};