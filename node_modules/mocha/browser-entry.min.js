"use strict";process.stdout=require("browser-stdout")();var Mocha=require("./lib/mocha");var mocha=new Mocha({reporter:"html"});var Date=global.Date;var setTimeout=global.setTimeout;var setInterval=global.setInterval;var clearTimeout=global.clearTimeout;var clearInterval=global.clearInterval;var uncaughtExceptionHandlers=[];var originalOnerrorHandler=global.onerror;process.removeListener=function(c,b){if(c==="uncaughtException"){if(originalOnerrorHandler){global.onerror=originalOnerrorHandler}else{global.onerror=function(){}}var a=Mocha.utils.indexOf(uncaughtExceptionHandlers,b);if(a!==-1){uncaughtExceptionHandlers.splice(a,1)}}};process.on=function(b,a){if(b==="uncaughtException"){global.onerror=function(e,d,c){a(new Error(e+" ("+d+":"+c+")"));return !mocha.allowUncaught};uncaughtExceptionHandlers.push(a)}};mocha.suite.removeAllListeners("pre-require");var immediateQueue=[];var immediateTimeout;function timeslice(){var a=new Date().getTime();while(immediateQueue.length&&(new Date().getTime()-a)<100){immediateQueue.shift()()}if(immediateQueue.length){immediateTimeout=setTimeout(timeslice,0)}else{immediateTimeout=null}}Mocha.Runner.immediately=function(a){immediateQueue.push(a);if(!immediateTimeout){immediateTimeout=setTimeout(timeslice,0)}};mocha.throwError=function(a){Mocha.utils.forEach(uncaughtExceptionHandlers,function(b){b(a)});throw a};mocha.ui=function(a){Mocha.prototype.ui.call(this,a);this.suite.emit("pre-require",global,null,this);return this};mocha.setup=function(b){if(typeof b==="string"){b={ui:b}}for(var a in b){if(b.hasOwnProperty(a)){this[a](b[a])}}return this};mocha.run=function(b){var a=mocha.options;mocha.globals("location");var c=Mocha.utils.parseQuery(global.location.search||"");if(c.grep){mocha.grep(c.grep)}if(c.fgrep){mocha.fgrep(c.fgrep)}if(c.invert){mocha.invert()}return Mocha.prototype.run.call(mocha,function(e){var d=global.document;if(d&&d.getElementById("mocha")&&a.noHighlighting!==true){Mocha.utils.highlightTags("code")}if(b){b(e)}})};Mocha.process=process;global.Mocha=Mocha;global.mocha=mocha;module.exports=global;