"use strict";var utils=require("./utils");var formats=require("./formats");var arrayPrefixGenerators={brackets:function brackets(a){return a+"[]"},indices:function indices(b,a){return b+"["+a+"]"},repeat:function repeat(a){return a}};var toISO=Date.prototype.toISOString;var defaults={delimiter:"&",encode:true,encoder:utils.encode,encodeValuesOnly:false,serializeDate:function serializeDate(a){return toISO.call(a)},skipNulls:false,strictNullHandling:false};var stringify=function stringify(s,l,a,d,p,o,g,q,e,f,n,c){var h=s;if(typeof g==="function"){h=g(l,h)}else{if(h instanceof Date){h=f(h)}else{if(h===null){if(d){return o&&!c?o(l,defaults.encoder):l}h=""}}}if(typeof h==="string"||typeof h==="number"||typeof h==="boolean"||utils.isBuffer(h)){if(o){var k=c?l:o(l,defaults.encoder);return[n(k)+"="+n(o(h,defaults.encoder))]}return[n(l)+"="+n(String(h))]}var b=[];if(typeof h==="undefined"){return b}var r;if(Array.isArray(g)){r=g}else{var j=Object.keys(h);r=q?j.sort(q):j}for(var m=0;m<r.length;++m){var t=r[m];if(p&&h[t]===null){continue}if(Array.isArray(h)){b=b.concat(stringify(h[t],a(l,t),a,d,p,o,g,q,e,f,n,c))}else{b=b.concat(stringify(h[t],l+(e?"."+t:"["+t+"]"),a,d,p,o,g,q,e,f,n,c))}}return b};module.exports=function(w,m){var l=w;var e=m?utils.assign({},m):{};if(e.encoder!==null&&e.encoder!==undefined&&typeof e.encoder!=="function"){throw new TypeError("Encoder has to be a function.")}var u=typeof e.delimiter==="undefined"?defaults.delimiter:e.delimiter;var d=typeof e.strictNullHandling==="boolean"?e.strictNullHandling:defaults.strictNullHandling;var s=typeof e.skipNulls==="boolean"?e.skipNulls:defaults.skipNulls;var h=typeof e.encode==="boolean"?e.encode:defaults.encode;var r=typeof e.encoder==="function"?e.encoder:defaults.encoder;var t=typeof e.sort==="function"?e.sort:null;var g=typeof e.allowDots==="undefined"?false:e.allowDots;var j=typeof e.serializeDate==="function"?e.serializeDate:defaults.serializeDate;var c=typeof e.encodeValuesOnly==="boolean"?e.encodeValuesOnly:defaults.encodeValuesOnly;if(typeof e.format==="undefined"){e.format=formats["default"]}else{if(!Object.prototype.hasOwnProperty.call(formats.formatters,e.format)){throw new TypeError("Unknown format option provided.")}}var q=formats.formatters[e.format];var v;var k;if(typeof e.filter==="function"){k=e.filter;l=k("",l)}else{if(Array.isArray(e.filter)){k=e.filter;v=k}}var n=[];if(typeof l!=="object"||l===null){return""}var a;if(e.arrayFormat in arrayPrefixGenerators){a=e.arrayFormat}else{if("indices" in e){a=e.indices?"indices":"repeat"}else{a="indices"}}var b=arrayPrefixGenerators[a];if(!v){v=Object.keys(l)}if(t){v.sort(t)}for(var p=0;p<v.length;++p){var x=v[p];if(s&&l[x]===null){continue}n=n.concat(stringify(l[x],x,b,d,s,h?r:null,k,t,g,j,q,c))}var f=n.join(u);var o=e.addQueryPrefix===true?"?":"";return f.length>0?o+f:""};