"use strict";var utils=require("./utils");var has=Object.prototype.hasOwnProperty;var defaults={allowDots:false,allowPrototypes:false,arrayLimit:20,decoder:utils.decode,delimiter:"&",depth:5,parameterLimit:1000,plainObjects:false,strictNullHandling:false};var parseValues=function parseQueryStringValues(j,m){var f={};var g=m.ignoreQueryPrefix?j.replace(/^\?/,""):j;var d=m.parameterLimit===Infinity?undefined:m.parameterLimit;var e=g.split(m.delimiter,d);for(var h=0;h<e.length;++h){var b=e[h];var a=b.indexOf("]=");var k=a===-1?b.indexOf("="):a+1;var l,c;if(k===-1){l=m.decoder(b,defaults.decoder);c=m.strictNullHandling?null:""}else{l=m.decoder(b.slice(0,k),defaults.decoder);c=m.decoder(b.slice(k+1),defaults.decoder)}if(has.call(f,l)){f[l]=[].concat(f[l]).concat(c)}else{f[l]=c}}return f};var parseObject=function(a,b,j){var g=b;for(var d=a.length-1;d>=0;--d){var c;var h=a[d];if(h==="[]"){c=[];c=c.concat(g)}else{c=j.plainObjects?Object.create(null):{};var e=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h;var f=parseInt(e,10);if(!isNaN(f)&&h!==e&&String(f)===e&&f>=0&&(j.parseArrays&&f<=j.arrayLimit)){c=[];c[f]=g}else{c[e]=g}}g=c}return g};var parseKeys=function parseQueryStringKeys(a,c,k){if(!a){return}var g=k.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a;var j=/(\[[^[\]]*])/;var b=/(\[[^[\]]*])/g;var e=j.exec(g);var f=e?g.slice(0,e.index):g;var h=[];if(f){if(!k.plainObjects&&has.call(Object.prototype,f)){if(!k.allowPrototypes){return}}h.push(f)}var d=0;while((e=b.exec(g))!==null&&d<k.depth){d+=1;if(!k.plainObjects&&has.call(Object.prototype,e[1].slice(1,-1))){if(!k.allowPrototypes){return}}h.push(e[1])}if(e){h.push("["+g.slice(e.index)+"]")}return parseObject(h,c,k)};module.exports=function(e,a){var j=a?utils.assign({},a):{};if(j.decoder!==null&&j.decoder!==undefined&&typeof j.decoder!=="function"){throw new TypeError("Decoder has to be a function.")}j.ignoreQueryPrefix=j.ignoreQueryPrefix===true;j.delimiter=typeof j.delimiter==="string"||utils.isRegExp(j.delimiter)?j.delimiter:defaults.delimiter;j.depth=typeof j.depth==="number"?j.depth:defaults.depth;j.arrayLimit=typeof j.arrayLimit==="number"?j.arrayLimit:defaults.arrayLimit;j.parseArrays=j.parseArrays!==false;j.decoder=typeof j.decoder==="function"?j.decoder:defaults.decoder;j.allowDots=typeof j.allowDots==="boolean"?j.allowDots:defaults.allowDots;j.plainObjects=typeof j.plainObjects==="boolean"?j.plainObjects:defaults.plainObjects;j.allowPrototypes=typeof j.allowPrototypes==="boolean"?j.allowPrototypes:defaults.allowPrototypes;j.parameterLimit=typeof j.parameterLimit==="number"?j.parameterLimit:defaults.parameterLimit;j.strictNullHandling=typeof j.strictNullHandling==="boolean"?j.strictNullHandling:defaults.strictNullHandling;if(e===""||e===null||typeof e==="undefined"){return j.plainObjects?Object.create(null):{}}var f=typeof e==="string"?parseValues(e,j):e;var c=j.plainObjects?Object.create(null):{};var h=Object.keys(f);for(var d=0;d<h.length;++d){var g=h[d];var b=parseKeys(g,f[g],j);c=utils.merge(c,b,j)}return utils.compact(c)};