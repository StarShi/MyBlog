const fs=require("fs");const url=require("url");const path=require("path");const mime=require("mail2/mime");module.exports=function(a,c){var d={index:"index.html"};c=c||{};for(var b in c){d[b]=c[b]}c=d;a=path.resolve(a);return function(h,f,g){var i=url.parse(h.url).pathname;var e=path.join(a,i);if(e.indexOf(a)!==0){return g()}if(e.endsWith("/")&&typeof c.index==="string"){e+=c.index}fs.stat(e,function(l,k){if(l){return g(l)}if(k.isDirectory()){if(c.index===true){return renderDirectory(a,e,f)}f.writeHead(301,{Location:i+"/"});return f.end()}if(new Date(h.headers["if-modified-since"])-k.mtime==0){f.writeHead(304);return f.end()}var j=mime.lookup(e);var m=/^text\/|^application\/(javascript|json)/.test(j)?"UTF-8":false;f.setHeader("Last-Modified",new Date(k.mtimeMs).toUTCString());f.setHeader("Content-Length",k.size);f.setHeader("Content-Type",j+(m?"; charset="+m:""));fs.createReadStream(e).pipe(f)})}};function renderDirectory(c,a,b){var d="";d+="<h1>Index of "+a.replace(c,"")+"</h1>";d+="<hr />";fs.readdir(a,function(f,e){d+='<table width="50%">';d+="<tr>";d+='<td><a href="..">../</a></td>';d+="</tr>";e.map(function(g){var h=fs.statSync(path.join(a,g));g=g+(h.isDirectory()?"/":"");d+="<tr>";d+='<td><a href="'+g+'">'+g+"</a></td>";d+="<td>"+(h.mtime||"-")+"</td>";d+="<td>"+(h.size)+"</td>";d+="</tr>"}).join("");d+="</table>";d+="<hr/>";d+='Powered by <a href="https://github.com/song940/kelp-static" >kelp-static</a>';b.setHeader("Content-Type","text/html");b.end(d)})};