/*!
 * media-typer
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */
;var paramRegExp=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g;var textRegExp=/^[\u0020-\u007e\u0080-\u00ff]+$/;var tokenRegExp=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/;var qescRegExp=/\\([\u0000-\u007f])/g;var quoteRegExp=/([\\"])/g;var subtypeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/;var typeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/;var typeRegExp=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;exports.format=format;exports.parse=parse;function format(d){if(!d||typeof d!=="object"){throw new TypeError("argument obj is required")}var j=d.parameters;var f=d.subtype;var h=d.suffix;var g=d.type;if(!g||!typeNameRegExp.test(g)){throw new TypeError("invalid type")}if(!f||!subtypeNameRegExp.test(f)){throw new TypeError("invalid subtype")}var e=g+"/"+f;if(h){if(!typeNameRegExp.test(h)){throw new TypeError("invalid suffix")}e+="+"+h}if(j&&typeof j==="object"){var a;var b=Object.keys(j).sort();for(var c=0;c<b.length;c++){a=b[c];if(!tokenRegExp.test(a)){throw new TypeError("invalid parameter name")}e+="; "+a+"="+qstring(j[a])}}return e}function parse(c){if(!c){throw new TypeError("argument string is required")}if(typeof c==="object"){c=getcontenttype(c)}if(typeof c!=="string"){throw new TypeError("argument string is required to be a string")}var b=c.indexOf(";");var e=b!==-1?c.substr(0,b):c;var d;var a;var g=splitType(e);var h={};var f;paramRegExp.lastIndex=b;while(a=paramRegExp.exec(c)){if(a.index!==b){throw new TypeError("invalid parameter format")}b+=a[0].length;d=a[1].toLowerCase();f=a[2];if(f[0]==='"'){f=f.substr(1,f.length-2).replace(qescRegExp,"$1")}h[d]=f}if(b!==-1&&b!==c.length){throw new TypeError("invalid parameter format")}g.parameters=h;return g}function getcontenttype(a){if(typeof a.getHeader==="function"){return a.getHeader("content-type")}if(typeof a.headers==="object"){return a.headers&&a.headers["content-type"]}}function qstring(b){var a=String(b);if(tokenRegExp.test(a)){return a}if(a.length>0&&!textRegExp.test(a)){throw new TypeError("invalid parameter value")}return'"'+a.replace(quoteRegExp,"\\$1")+'"'}function splitType(d){var c=typeRegExp.exec(d.toLowerCase());if(!c){throw new TypeError("invalid media type")}var e=c[1];var a=c[2];var g;var b=a.lastIndexOf("+");if(b!==-1){g=a.substr(b+1);a=a.substr(0,b)}var f={type:e,subtype:a,suffix:g};return f};