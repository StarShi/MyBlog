/*!
 * cookie-parser
 * Copyright(c) 2014 TJ Holowaychuk
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var cookie=require("cookie");var signature=require("cookie-signature");module.exports=cookieParser;module.exports.JSONCookie=JSONCookie;module.exports.JSONCookies=JSONCookies;module.exports.signedCookie=signedCookie;module.exports.signedCookies=signedCookies;function cookieParser(a,c){return function b(h,e,f){if(h.cookies){return f()}var g=h.headers.cookie;var d=!a||Array.isArray(a)?(a||[]):[a];h.secret=d[0];h.cookies=Object.create(null);h.signedCookies=Object.create(null);if(!g){return f()}h.cookies=cookie.parse(g,c);if(d.length!==0){h.signedCookies=signedCookies(h.cookies,d);h.signedCookies=JSONCookies(h.signedCookies)}h.cookies=JSONCookies(h.cookies);f()}}function JSONCookie(b){if(typeof b!=="string"||b.substr(0,2)!=="j:"){return undefined}try{return JSON.parse(b.slice(2))}catch(a){return undefined}}function JSONCookies(d){var c=Object.keys(d);var b;var e;for(var a=0;a<c.length;a++){b=c[a];e=JSONCookie(d[b]);if(e){d[b]=e}}return d}function signedCookie(e,a){if(typeof e!=="string"){return undefined}if(e.substr(0,2)!=="s:"){return e}var b=!a||Array.isArray(a)?(a||[]):[a];for(var c=0;c<b.length;c++){var d=signature.unsign(e.slice(2),b[c]);if(d!==false){return d}}return false}function signedCookies(f,a){var e=Object.keys(f);var h;var d;var b=Object.create(null);var g;for(var c=0;c<e.length;c++){d=e[c];g=f[d];h=signedCookie(g,a);if(g!==h){b[d]=h;delete f[d]}}return b};