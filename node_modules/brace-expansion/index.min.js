var concatMap=require("concat-map");var balanced=require("balanced-match");module.exports=expandTop;var escSlash="\0SLASH"+Math.random()+"\0";var escOpen="\0OPEN"+Math.random()+"\0";var escClose="\0CLOSE"+Math.random()+"\0";var escComma="\0COMMA"+Math.random()+"\0";var escPeriod="\0PERIOD"+Math.random()+"\0";function numeric(a){return parseInt(a,10)==a?parseInt(a,10):a.charCodeAt(0)}function escapeBraces(a){return a.split("\\\\").join(escSlash).split("\\{").join(escOpen).split("\\}").join(escClose).split("\\,").join(escComma).split("\\.").join(escPeriod)}function unescapeBraces(a){return a.split(escSlash).join("\\").split(escOpen).join("{").split(escClose).join("}").split(escComma).join(",").split(escPeriod).join(".")}function parseCommaParts(h){if(!h){return[""]}var g=[];var b=balanced("{","}",h);if(!b){return h.split(",")}var f=b.pre;var a=b.body;var c=b.post;var e=f.split(",");e[e.length-1]+="{"+a+"}";var d=parseCommaParts(c);if(c.length){e[e.length-1]+=d.shift();e.push.apply(e,d)}g.push.apply(g,e);return g}function expandTop(a){if(!a){return[]}if(a.substr(0,2)==="{}"){a="\\{\\}"+a.substr(2)}return expand(escapeBraces(a),true).map(unescapeBraces)}function identity(a){return a}function embrace(a){return"{"+a+"}"}function isPadded(a){return/^-?0\d/.test(a)}function lte(a,b){return a<=b}function gte(a,b){return a>=b}function expand(t,F){var v=[];var u=balanced("{","}",t);if(!u||/\$$/.test(u.pre)){return[t]}var E=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(u.body);var o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(u.body);var b=E||o;var a=u.body.indexOf(",")>=0;if(!b&&!a){if(u.post.match(/,.*\}/)){t=u.pre+"{"+u.body+escClose+u.post;return expand(t)}return[t]}var r;if(b){r=u.body.split(/\.\./)}else{r=parseCommaParts(u.body);if(r.length===1){r=expand(r[0],false).map(embrace);if(r.length===1){var C=u.post.length?expand(u.post,false):[""];return C.map(function(c){return u.pre+r[0]+c})}}}var q=u.pre;var C=u.post.length?expand(u.post,false):[""];var d;if(b){var h=numeric(r[0]);var g=numeric(r[1]);var s=Math.max(r[0].length,r[1].length);var D=r.length==3?Math.abs(numeric(r[2])):1;var G=lte;var f=g<h;if(f){D*=-1;G=gte}var H=r.some(isPadded);d=[];for(var B=h;G(B,g);B+=D){var I;if(o){I=String.fromCharCode(B);if(I==="\\"){I=""}}else{I=String(B);if(H){var l=s-I.length;if(l>0){var e=new Array(l+1).join("0");if(B<0){I="-"+e+I.slice(1)}else{I=e+I}}}}d.push(I)}}else{d=concatMap(r,function(c){return expand(c,false)})}for(var A=0;A<d.length;A++){for(var w=0;w<C.length;w++){var p=q+d[A]+C[w];if(!F||b||p){v.push(p)}}}return v};