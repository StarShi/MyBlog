"use strict";module.exports=function(h,f){var d=require("./util");var i=d.errorObj;var k=d.isObject;function b(n,m){if(k(n)){if(n instanceof h){return n}var o=c(n);if(o===i){if(m){m._pushContext()}var l=h.reject(o.e);if(m){m._popContext()}return l}else{if(typeof o==="function"){if(a(n)){var l=new h(f);n._then(l._fulfill,l._reject,undefined,l,null);return l}return j(n,o,m)}}}return n}function e(l){return l.then}function c(m){try{return e(m)}catch(l){i.e=l;return i}}var g={}.hasOwnProperty;function a(m){try{return g.call(m,"_promise0")}catch(l){return false}}function j(p,n,m){var s=new h(f);var o=s;if(m){m._pushContext()}s._captureStackTrace();if(m){m._popContext()}var l=true;var t=d.tryCatch(n).call(p,q,r);l=false;if(s&&t===i){s._rejectCallback(t.e,true,true);s=null}function q(u){if(!s){return}s._resolveCallback(u);s=null}function r(u){if(!s){return}s._rejectCallback(u,l,true);s=null}return o}return b};