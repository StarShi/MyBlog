"use strict";module.exports=function(j,d){var q={};var b=require("./util");var B=require("./nodeback");var z=b.withAppended;var t=b.maybeWrapAsError;var s=b.canEvaluate;var p=require("./errors").TypeError;var y="Async";var n={__isPromisified__:true};var l=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"];var v=new RegExp("^(?:"+l.join("|")+")$");var e=function(D){return b.isIdentifier(D)&&D.charAt(0)!=="_"&&D!=="constructor"};function C(D){return !v.test(D)}function u(D){try{return D.__isPromisified__===true}catch(E){return false}}function o(F,D,E){var G=b.getDataPropertyOrDefault(F,D+E,n);return G?u(G):false}function c(E,J,H){for(var G=0;G<E.length;G+=2){var F=E[G];if(H.test(F)){var I=F.replace(H,"");for(var D=0;D<E.length;D+=2){if(E[D]===I){throw new p("Cannot promisify an API that has normal methods with '%s'-suffix\u000a\u000a    See http://goo.gl/MqrFmX\u000a".replace("%s",J))}}}}}function r(G,L,F,E){var M=b.inheritedDataKeys(G);var I=[];for(var H=0;H<M.length;++H){var K=M[H];var J=G[K];var D=E===e?true:e(K,J,G);if(typeof J==="function"&&!u(J)&&!o(G,K,L)&&E(K,J,G,D)){I.push(K,J)}}c(I,L,F);return I}var i=function(D){return D.replace(/([$])/,"\\$")};var f;if(!false){var k=function(G){var D=[G];var F=Math.max(0,G-1-3);for(var E=G-1;E>=F;--E){D.push(E)}for(var E=G+1;E<=3;++E){D.push(E)}return D};var h=function(D){return b.filledRange(D,"_arg","")};var w=function(D){return b.filledRange(Math.max(D,3),"_arg","")};var A=function(D){if(typeof D.length==="number"){return Math.max(Math.min(D.length,1023+1),0)}return 0};f=function(P,D,L,N,O,G){var K=Math.max(0,A(N)-1);var F=k(K);var I=typeof P==="string"||D===q;function M(T){var S=h(T).join(", ");var Q=T>0?", ":"";var R;if(I){R="ret = callback.call(this, {{args}}, nodeback); break;\n"}else{R=D===undefined?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n"}return R.replace("{{args}}",S).replace(", ",Q)}function E(){var Q="";for(var R=0;R<F.length;++R){Q+="case "+F[R]+":"+M(F[R])}Q+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",(I?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n"));return Q}var H=typeof P==="string"?("this != null ? this['"+P+"'] : fn"):"fn";var J="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+G+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",E()).replace("[GetFunctionCode]",H);J=J.replace("Parameters",w(K));return new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",J)(j,N,D,z,t,B,b.tryCatch,b.errorObj,b.notEnumerableProp,d)}}function m(L,E,K,I,J,F){var G=(function(){return this})();var D=L;if(typeof D==="string"){L=I}function H(){var P=E;if(E===q){P=this}var Q=new j(d);Q._captureStackTrace();var M=typeof D==="string"&&this!==G?this[D]:L;var N=B(Q,F);try{M.apply(P,z(arguments,N))}catch(O){Q._rejectCallback(t(O),true,true)}if(!Q._isFateSealed()){Q._setAsyncGuaranteed()}return Q}b.notEnumerableProp(H,"__isPromisified__",true);return H}var a=s?f:m;function x(I,P,E,D,F){var G=new RegExp(i(P)+"$");var H=r(I,P,G,E);for(var J=0,L=H.length;J<L;J+=2){var O=H[J];var N=H[J+1];var K=O+P;if(D===a){I[K]=a(O,q,O,N,P,F)}else{var M=D(N,function(){return a(O,q,O,N,P,F)});b.notEnumerableProp(M,"__isPromisified__",true);I[K]=M}}b.toFastProperties(I);return I}function g(F,D,E){return a(F,D,undefined,F,null,E)}j.promisify=function(F,E){if(typeof F!=="function"){throw new p("expecting a function but got "+b.classString(F))}if(u(F)){return F}E=Object(E);var G=E.context===undefined?q:E.context;var H=!!E.multiArgs;var D=g(F,G,H);b.copyDescriptors(F,D,C);return D};j.promisifyAll=function(H,L){if(typeof H!=="function"&&typeof H!=="object"){throw new p("the target of promisifyAll must be an object or a function\u000a\u000a    See http://goo.gl/MqrFmX\u000a")}L=Object(L);var F=!!L.multiArgs;var J=L.suffix;if(typeof J!=="string"){J=y}var E=L.filter;if(typeof E!=="function"){E=e}var D=L.promisifier;if(typeof D!=="function"){D=a}if(!b.isIdentifier(J)){throw new RangeError("suffix must be a valid identifier\u000a\u000a    See http://goo.gl/MqrFmX\u000a")}var K=b.inheritedDataKeys(H);for(var G=0;G<K.length;++G){var I=H[K[G]];if(K[G]!=="constructor"&&b.isClass(I)){x(I.prototype,J,E,D,F);x(I,J,E,D,F)}}return x(H,J,E,D,F)}};