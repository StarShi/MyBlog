"use strict";module.exports=function(l,j,c,g,i,d){var n=l._getDomain;var h=require("./util");var e=h.tryCatch;function m(p,r,o,q){this.constructor$(p);var s=n();this._fn=s===null?r:h.domainBind(s,r);if(o!==undefined){o=l.resolve(o);o._attachCancellationCallback(this)}this._initialValue=o;this._currentCancellable=null;if(q===i){this._eachValues=Array(this._length)}else{if(q===0){this._eachValues=null}else{this._eachValues=undefined}}this._promise._captureStackTrace();this._init$(undefined,-5)}h.inherits(m,j);m.prototype._gotAccum=function(o){if(this._eachValues!==undefined&&this._eachValues!==null&&o!==i){this._eachValues.push(o)}};m.prototype._eachComplete=function(o){if(this._eachValues!==null){this._eachValues.push(o)}return this._eachValues};m.prototype._init=function(){};m.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues!==undefined?this._eachValues:this._initialValue)};m.prototype.shouldCopyValues=function(){return false};m.prototype._resolve=function(o){this._promise._resolveCallback(o);this._values=null};m.prototype._resultCancelled=function(o){if(o===this._initialValue){return this._cancel()}if(this._isResolved()){return}this._resultCancelled$();if(this._currentCancellable instanceof l){this._currentCancellable.cancel()}if(this._initialValue instanceof l){this._initialValue.cancel()}};m.prototype._iterate=function(p){this._values=p;var s;var q;var r=p.length;if(this._initialValue!==undefined){s=this._initialValue;q=0}else{s=l.resolve(p[0]);q=1}this._currentCancellable=s;if(!s.isRejected()){for(;q<r;++q){var o={accum:null,value:p[q],index:q,length:r,array:this};s=s._then(b,undefined,undefined,o,undefined)}}if(this._eachValues!==undefined){s=s._then(this._eachComplete,undefined,undefined,this,undefined)}s._then(f,f,undefined,s,this)};l.prototype.reduce=function(p,o){return k(this,p,o,null)};l.reduce=function(p,r,o,q){return k(p,r,o,q)};function f(o,p){if(this.isFulfilled()){p._resolve(o)}else{p._reject(o)}}function k(p,r,o,q){if(typeof r!=="function"){return c("expecting a function but got "+h.classString(r))}var s=new m(p,r,o,q);return s.promise()}function b(o){this.accum=o;this.array._gotAccum(o);var p=g(this.value,this.array._promise);if(p instanceof l){this.array._currentCancellable=p;return p._then(a,undefined,undefined,this,undefined)}else{return a.call(this,p)}}function a(r){var t=this.array;var s=t._promise;var q=e(t._fn);s._pushContext();var o;if(t._eachValues!==undefined){o=q.call(s._boundValue(),r,this.index,this.length)}else{o=q.call(s._boundValue(),this.accum,r,this.index,this.length)}if(o instanceof l){t._currentCancellable=o}var p=s._popContext();d.checkForgottenReturns(o,p,t._eachValues!==undefined?"Promise.each":"Promise.reduce",s);return o}};