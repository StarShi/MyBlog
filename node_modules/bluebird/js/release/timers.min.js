"use strict";module.exports=function(j,i,b){var h=require("./util");var a=j.TimeoutError;function e(l){this.handle=l}e.prototype._resultCancelled=function(){clearTimeout(this.handle)};var g=function(l){return f(+this).thenReturn(l)};var f=j.delay=function(m,o){var l;var n;if(o!==undefined){l=j.resolve(o)._then(g,null,null,m,undefined);if(b.cancellation()&&o instanceof j){l._setOnCancel(o)}}else{l=new j(i);n=setTimeout(function(){l._fulfill()},+m);if(b.cancellation()){l._setOnCancel(new e(n))}l._captureStackTrace()}l._setAsyncGuaranteed();return l};j.prototype.delay=function(l){return f(l,this)};var c=function(o,n,l){var m;if(typeof n!=="string"){if(n instanceof Error){m=n}else{m=new a("operation timed out")}}else{m=new a(n)}h.markAsOriginatingFromRejection(m);o._attachExtraTrace(m);o._reject(m);if(l!=null){l.cancel()}};function d(l){clearTimeout(this.handle);return l}function k(l){clearTimeout(this.handle);throw l}j.prototype.timeout=function(o,q){o=+o;var n,p;var m=new e(setTimeout(function l(){if(n.isPending()){c(n,q,p)}},o));if(b.cancellation()){p=this.then();n=p._then(d,k,undefined,m,undefined);n._setOnCancel(m)}else{n=this._then(d,k,undefined,m,undefined)}return n}};