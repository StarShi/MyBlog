"use strict";module.exports=function(){var d=function(){return new n("circular promise resolution chain\u000a\u000a    See http://goo.gl/MqrFmX\u000a")};var D=function(){return new f.PromiseInspection(this._target())};var C=function(G){return f.reject(new n(G))};function r(){}var a={};var b=require("./util");var B;if(b.isNode){B=function(){var G=process.domain;if(G===undefined){G=null}return G}}else{B=function(){return null}}b.notEnumerableProp(f,"_getDomain",B);var A=require("./es5");var s=require("./async");var j=new s();A.defineProperty(f,"_async",{value:j});var p=require("./errors");var n=f.TypeError=p.TypeError;f.RangeError=p.RangeError;var u=f.CancellationError=p.CancellationError;f.TimeoutError=p.TimeoutError;f.OperationalError=p.OperationalError;f.RejectionError=p.OperationalError;f.AggregateError=p.AggregateError;var c=function(){};var i={};var e={};var k=require("./thenables")(f,c);var F=require("./promise_array")(f,c,k,C,r);var w=require("./context")(f);var v=w.create;var t=require("./debuggability")(f,w);var q=t.CapturedTrace;var x=require("./finally")(f,k,e);var h=require("./catch_filter")(e);var z=require("./nodeback");var l=b.errorObj;var o=b.tryCatch;function y(G,H){if(G==null||G.constructor!==f){throw new n("the promise constructor cannot be invoked directly\u000a\u000a    See http://goo.gl/MqrFmX\u000a")}if(typeof H!=="function"){throw new n("expecting a function but got "+b.classString(H))}}function f(G){if(G!==c){y(this,G)}this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;this._resolveFromExecutor(G);this._promiseCreated();this._fireEvent("promiseCreated",this)}f.prototype.toString=function(){return"[object Promise]"};f.prototype.caught=f.prototype["catch"]=function(J){var G=arguments.length;if(G>1){var L=new Array(G-1),H=0,I;for(I=0;I<G-1;++I){var K=arguments[I];if(b.isObject(K)){L[H++]=K}else{return C("Catch statement predicate: expecting an object but got "+b.classString(K))}}L.length=H;J=arguments[I];return this.then(undefined,h(L,J,this))}return this.then(undefined,J)};f.prototype.reflect=function(){return this._then(D,D,undefined,this,undefined)};f.prototype.then=function(H,G){if(t.warnings()&&arguments.length>0&&typeof H!=="function"&&typeof G!=="function"){var I=".then() only accepts functions but was passed: "+b.classString(H);if(arguments.length>1){I+=", "+b.classString(G)}this._warn(I)}return this._then(H,G,undefined,undefined,undefined)};f.prototype.done=function(H,G){var I=this._then(H,G,undefined,undefined,undefined);I._setIsFinal()};f.prototype.spread=function(G){if(typeof G!=="function"){return C("expecting a function but got "+b.classString(G))}return this.all()._then(G,undefined,undefined,i,undefined)};f.prototype.toJSON=function(){var G={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){G.fulfillmentValue=this.value();G.isFulfilled=true}else{if(this.isRejected()){G.rejectionReason=this.reason();G.isRejected=true}}return G};f.prototype.all=function(){if(arguments.length>0){this._warn(".all() was passed arguments but it does not take any")}return new F(this).promise()};f.prototype.error=function(G){return this.caught(b.originatesFromRejection,G)};f.getNewLibraryCopy=module.exports;f.is=function(G){return G instanceof f};f.fromNode=f.fromCallback=function(I){var H=new f(c);H._captureStackTrace();var J=arguments.length>1?!!Object(arguments[1]).multiArgs:false;var G=o(I)(z(H,J));if(G===l){H._rejectCallback(G.e,true)}if(!H._isFateSealed()){H._setAsyncGuaranteed()}return H};f.all=function(G){return new F(G).promise()};f.cast=function(H){var G=k(H);if(!(G instanceof f)){G=new f(c);G._captureStackTrace();G._setFulfilled();G._rejectionHandler0=H}return G};f.resolve=f.fulfilled=f.cast;f.reject=f.rejected=function(H){var G=new f(c);G._captureStackTrace();G._rejectCallback(H,true);return G};f.setScheduler=function(G){if(typeof G!=="function"){throw new n("expecting a function but got "+b.classString(G))}return j.setScheduler(G)};f.prototype._then=function(H,O,P,G,M){var R=M!==undefined;var S=R?M:new f(c);var L=this._target();var K=L._bitField;if(!R){S._propagateFrom(this,3);S._captureStackTrace();if(G===undefined&&((this._bitField&2097152)!==0)){if(!((K&50397184)===0)){G=this._boundValue()}else{G=L===this?undefined:this._boundTo}}this._fireEvent("promiseChained",this,S)}var J=B();if(!((K&50397184)===0)){var Q,N,I=L._settlePromiseCtx;if(((K&33554432)!==0)){N=L._rejectionHandler0;Q=H}else{if(((K&16777216)!==0)){N=L._fulfillmentHandler0;Q=O;L._unsetRejectionIsUnhandled()}else{I=L._settlePromiseLateCancellationObserver;N=new u("late cancellation observer");L._attachExtraTrace(N);Q=O}}j.invoke(I,L,{handler:J===null?Q:(typeof Q==="function"&&b.domainBind(J,Q)),promise:S,receiver:G,value:N})}else{L._addCallbacks(H,O,S,G,J)}return S};f.prototype._length=function(){return this._bitField&65535};f.prototype._isFateSealed=function(){return(this._bitField&117506048)!==0};f.prototype._isFollowing=function(){return(this._bitField&67108864)===67108864};f.prototype._setLength=function(G){this._bitField=(this._bitField&-65536)|(G&65535)};f.prototype._setFulfilled=function(){this._bitField=this._bitField|33554432;this._fireEvent("promiseFulfilled",this)};f.prototype._setRejected=function(){this._bitField=this._bitField|16777216;this._fireEvent("promiseRejected",this)};f.prototype._setFollowing=function(){this._bitField=this._bitField|67108864;this._fireEvent("promiseResolved",this)};f.prototype._setIsFinal=function(){this._bitField=this._bitField|4194304};f.prototype._isFinal=function(){return(this._bitField&4194304)>0};f.prototype._unsetCancelled=function(){this._bitField=this._bitField&(~65536)};f.prototype._setCancelled=function(){this._bitField=this._bitField|65536;this._fireEvent("promiseCancelled",this)};f.prototype._setWillBeCancelled=function(){this._bitField=this._bitField|8388608};f.prototype._setAsyncGuaranteed=function(){if(j.hasCustomScheduler()){return}this._bitField=this._bitField|134217728};f.prototype._receiverAt=function(H){var G=H===0?this._receiver0:this[H*4-4+3];if(G===a){return undefined}else{if(G===undefined&&this._isBound()){return this._boundValue()}}return G};f.prototype._promiseAt=function(G){return this[G*4-4+2]};f.prototype._fulfillmentHandlerAt=function(G){return this[G*4-4+0]};f.prototype._rejectionHandlerAt=function(G){return this[G*4-4+1]};f.prototype._boundValue=function(){};f.prototype._migrateCallback0=function(K){var H=K._bitField;var G=K._fulfillmentHandler0;var J=K._rejectionHandler0;var L=K._promise0;var I=K._receiverAt(0);if(I===undefined){I=a}this._addCallbacks(G,J,L,I,null)};f.prototype._migrateCallbackAt=function(K,G){var H=K._fulfillmentHandlerAt(G);var J=K._rejectionHandlerAt(G);var L=K._promiseAt(G);var I=K._receiverAt(G);if(I===undefined){I=a}this._addCallbacks(H,J,L,I,null)};f.prototype._addCallbacks=function(H,L,M,K,J){var G=this._length();if(G>=65535-4){G=0;this._setLength(0)}if(G===0){this._promise0=M;this._receiver0=K;if(typeof H==="function"){this._fulfillmentHandler0=J===null?H:b.domainBind(J,H)}if(typeof L==="function"){this._rejectionHandler0=J===null?L:b.domainBind(J,L)}}else{var I=G*4-4;this[I+2]=M;this[I+3]=K;if(typeof H==="function"){this[I+0]=J===null?H:b.domainBind(J,H)}if(typeof L==="function"){this[I+1]=J===null?L:b.domainBind(J,L)}}this._setLength(G+1);return G};f.prototype._proxy=function(H,G){this._addCallbacks(undefined,undefined,G,H,null)};f.prototype._resolveCallback=function(K,N){if(((this._bitField&117506048)!==0)){return}if(K===this){return this._rejectCallback(d(),false)}var H=k(K,this);if(!(H instanceof f)){return this._fulfill(K)}if(N){this._propagateFrom(H,2)}var M=H._target();if(M===this){this._reject(d());return}var J=M._bitField;if(((J&50397184)===0)){var G=this._length();if(G>0){M._migrateCallback0(this)}for(var I=1;I<G;++I){M._migrateCallbackAt(this,I)}this._setFollowing();this._setLength(0);this._setFollowee(M)}else{if(((J&33554432)!==0)){this._fulfill(M._value())}else{if(((J&16777216)!==0)){this._reject(M._reason())}else{var L=new u("late cancellation observer");M._attachExtraTrace(L);this._reject(L)}}}};f.prototype._rejectCallback=function(K,G,L){var I=b.ensureErrorObject(K);var J=I===K;if(!J&&!L&&t.warnings()){var H="a promise was rejected with a non-error: "+b.classString(K);this._warn(H,true)}this._attachExtraTrace(I,G?J:false);this._reject(K)};f.prototype._resolveFromExecutor=function(J){if(J===c){return}var I=this;this._captureStackTrace();this._pushContext();var G=true;var H=this._execute(J,function(K){I._resolveCallback(K)},function(K){I._rejectCallback(K,G)});G=false;this._popContext();if(H!==undefined){I._rejectCallback(H,true)}};f.prototype._settlePromiseFromHandler=function(I,L,K,M){var J=M._bitField;if(((J&65536)!==0)){return}M._pushContext();var G;if(L===i){if(!K||typeof K.length!=="number"){G=l;G.e=new n("cannot .spread() a non-array: "+b.classString(K))}else{G=o(I).apply(this._boundValue(),K)}}else{G=o(I).call(L,K)}var H=M._popContext();J=M._bitField;if(((J&65536)!==0)){return}if(G===e){M._reject(K)}else{if(G===l){M._rejectCallback(G.e,false)}else{t.checkForgottenReturns(G,H,"",M,this);M._resolveCallback(G)}}};f.prototype._target=function(){var G=this;while(G._isFollowing()){G=G._followee()}return G};f.prototype._followee=function(){return this._rejectionHandler0};f.prototype._setFollowee=function(G){this._rejectionHandler0=G};f.prototype._settlePromise=function(M,H,L,K){var G=M instanceof f;var I=this._bitField;var J=((I&134217728)!==0);if(((I&65536)!==0)){if(G){M._invokeInternalOnCancel()}if(L instanceof x&&L.isFinallyHandler()){L.cancelPromise=M;if(o(H).call(L,K)===l){M._reject(l.e)}}else{if(H===D){M._fulfill(D.call(L))}else{if(L instanceof r){L._promiseCancelled(M)}else{if(G||M instanceof F){M._cancel()}else{L.cancel()}}}}}else{if(typeof H==="function"){if(!G){H.call(L,K,M)}else{if(J){M._setAsyncGuaranteed()}this._settlePromiseFromHandler(H,L,K,M)}}else{if(L instanceof r){if(!L._isResolved()){if(((I&33554432)!==0)){L._promiseFulfilled(K,M)}else{L._promiseRejected(K,M)}}}else{if(G){if(J){M._setAsyncGuaranteed()}if(((I&33554432)!==0)){M._fulfill(K)}else{M._reject(K)}}}}}};f.prototype._settlePromiseLateCancellationObserver=function(G){var H=G.handler;var K=G.promise;var J=G.receiver;var I=G.value;if(typeof H==="function"){if(!(K instanceof f)){H.call(J,I,K)}else{this._settlePromiseFromHandler(H,J,I,K)}}else{if(K instanceof f){K._reject(I)}}};f.prototype._settlePromiseCtx=function(G){this._settlePromise(G.promise,G.handler,G.receiver,G.value)};f.prototype._settlePromise0=function(G,J,H){var K=this._promise0;var I=this._receiverAt(0);this._promise0=undefined;this._receiver0=undefined;this._settlePromise(K,G,I,J)};f.prototype._clearCallbackDataAtIndex=function(G){var H=G*4-4;this[H+2]=this[H+3]=this[H+0]=this[H+1]=undefined};f.prototype._fulfill=function(I){var H=this._bitField;if(((H&117506048)>>>16)){return}if(I===this){var G=d();this._attachExtraTrace(G);return this._reject(G)}this._setFulfilled();this._rejectionHandler0=I;if((H&65535)>0){if(((H&134217728)!==0)){this._settlePromises()}else{j.settlePromises(this)}}};f.prototype._reject=function(H){var G=this._bitField;if(((G&117506048)>>>16)){return}this._setRejected();this._fulfillmentHandler0=H;if(this._isFinal()){return j.fatalError(H,b.isNode)}if((G&65535)>0){j.settlePromises(this)}else{this._ensurePossibleRejectionHandled()}};f.prototype._fulfillPromises=function(G,K){for(var H=1;H<G;H++){var I=this._fulfillmentHandlerAt(H);var L=this._promiseAt(H);var J=this._receiverAt(H);this._clearCallbackDataAtIndex(H);this._settlePromise(L,I,J,K)}};f.prototype._rejectPromises=function(G,K){for(var H=1;H<G;H++){var I=this._rejectionHandlerAt(H);var L=this._promiseAt(H);var J=this._receiverAt(H);this._clearCallbackDataAtIndex(H);this._settlePromise(L,I,J,K)}};f.prototype._settlePromises=function(){var H=this._bitField;var G=(H&65535);if(G>0){if(((H&16842752)!==0)){var J=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,J,H);this._rejectPromises(G,J)}else{var I=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,I,H);this._fulfillPromises(G,I)}this._setLength(0)}this._clearCancellationData()};f.prototype._settledValue=function(){var G=this._bitField;if(((G&33554432)!==0)){return this._rejectionHandler0}else{if(((G&16777216)!==0)){return this._fulfillmentHandler0}}};function g(G){this.promise._resolveCallback(G)}function m(G){this.promise._rejectCallback(G,false)}f.defer=f.pending=function(){t.deprecated("Promise.defer","new Promise");var G=new f(c);return{promise:G,resolve:g,reject:m}};b.notEnumerableProp(f,"_makeSelfResolutionError",d);require("./method")(f,c,k,C,t);require("./bind")(f,c,k,t);require("./cancel")(f,F,C,t);require("./direct_resolve")(f);require("./synchronous_inspection")(f);require("./join")(f,F,k,c,j,B);f.Promise=f;f.version="3.5.1";require("./map.js")(f,F,C,k,c,t);require("./call_get.js")(f);require("./using.js")(f,C,k,v,c,t);require("./timers.js")(f,c,t);require("./generators.js")(f,C,c,k,r,t);require("./nodeify.js")(f);require("./promisify.js")(f,c);require("./props.js")(f,F,k,C);require("./race.js")(f,c,k,C);require("./reduce.js")(f,F,C,k,c,t);require("./settle.js")(f,F,t);require("./some.js")(f,F,C);require("./filter.js")(f,c);require("./each.js")(f,c);require("./any.js")(f);b.toFastProperties(f);b.toFastProperties(f.prototype);function E(G){var H=new f(c);H._fulfillmentHandler0=G;H._rejectionHandler0=G;H._promise0=G;H._receiver0=G}E({a:1});E({b:2});E({c:3});E(1);E(function(){});E(undefined);E(false);E(new f(c));t.setBounds(s.firstLineError,b.lastLineError);return f};