"use strict";module.exports=function(i,e,b,a,g){var c=require("./util");var d=c.isArray;function h(k){switch(k){case -2:return[];case -3:return{};case -6:return new Map()}}function f(k){var l=this._promise=new i(e);if(k instanceof i){l._propagateFrom(k,3)}l._setOnCancel(this);this._values=k;this._length=0;this._totalResolved=0;this._init(undefined,-2)}c.inherits(f,g);f.prototype.length=function(){return this._length};f.prototype.promise=function(){return this._promise};f.prototype._init=function j(m,k){var l=b(this._values,this._promise);if(l instanceof i){l=l._target();var o=l._bitField;this._values=l;if(((o&50397184)===0)){this._promise._setAsyncGuaranteed();return l._then(j,this._reject,undefined,this,k)}else{if(((o&33554432)!==0)){l=l._value()}else{if(((o&16777216)!==0)){return this._reject(l._reason())}else{return this._cancel()}}}}l=c.asArray(l);if(l===null){var n=a("expecting an array or an iterable object but got "+c.classString(l)).reason();this._promise._rejectCallback(n,false);return}if(l.length===0){if(k===-5){this._resolveEmptyArray()}else{this._resolve(h(k))}return}this._iterate(l)};f.prototype._iterate=function(m){var l=this.getActualLength(m.length);this._length=l;this._values=this.shouldCopyValues()?new Array(l):this._values;var k=this._promise;var q=false;var p=null;for(var o=0;o<l;++o){var n=b(m[o],k);if(n instanceof i){n=n._target();p=n._bitField}else{p=null}if(q){if(p!==null){n.suppressUnhandledRejections()}}else{if(p!==null){if(((p&50397184)===0)){n._proxy(this,o);this._values[o]=n}else{if(((p&33554432)!==0)){q=this._promiseFulfilled(n._value(),o)}else{if(((p&16777216)!==0)){q=this._promiseRejected(n._reason(),o)}else{q=this._promiseCancelled(o)}}}}else{q=this._promiseFulfilled(n,o)}}}if(!q){k._setAsyncGuaranteed()}};f.prototype._isResolved=function(){return this._values===null};f.prototype._resolve=function(k){this._values=null;this._promise._fulfill(k)};f.prototype._cancel=function(){if(this._isResolved()||!this._promise._isCancellable()){return}this._values=null;this._promise._cancel()};f.prototype._reject=function(k){this._values=null;this._promise._rejectCallback(k,false)};f.prototype._promiseFulfilled=function(m,l){this._values[l]=m;var k=++this._totalResolved;if(k>=this._length){this._resolve(this._values);return true}return false};f.prototype._promiseCancelled=function(){this._cancel();return true};f.prototype._promiseRejected=function(k){this._totalResolved++;this._reject(k);return true};f.prototype._resultCancelled=function(){if(this._isResolved()){return}var k=this._values;this._cancel();if(k instanceof i){k.cancel()}else{for(var l=0;l<k.length;++l){if(k[l] instanceof i){k[l].cancel()}}}};f.prototype.shouldCopyValues=function(){return true};f.prototype.getActualLength=function(k){return k};return f};