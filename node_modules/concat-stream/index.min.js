var Writable=require("readable-stream").Writable;var inherits=require("inherits");if(typeof Uint8Array==="undefined"){var U8=require("typedarray").Uint8Array}else{var U8=Uint8Array}function ConcatStream(d,a){if(!(this instanceof ConcatStream)){return new ConcatStream(d,a)}if(typeof d==="function"){a=d;d={}}if(!d){d={}}var c=d.encoding;var b=false;if(!c){b=true}else{c=String(c).toLowerCase();if(c==="u8"||c==="uint8"){c="uint8array"}}Writable.call(this,{objectMode:true});this.encoding=c;this.shouldInferEncoding=b;if(a){this.on("finish",function(){a(this.getBody())})}this.body=[]}module.exports=ConcatStream;inherits(ConcatStream,Writable);ConcatStream.prototype._write=function(b,a,c){this.body.push(b);c()};ConcatStream.prototype.inferEncoding=function(b){var a=b===undefined?this.body[0]:b;if(Buffer.isBuffer(a)){return"buffer"}if(typeof Uint8Array!=="undefined"&&a instanceof Uint8Array){return"uint8array"}if(Array.isArray(a)){return"array"}if(typeof a==="string"){return"string"}if(Object.prototype.toString.call(a)==="[object Object]"){return"object"}return"buffer"};ConcatStream.prototype.getBody=function(){if(!this.encoding&&this.body.length===0){return[]}if(this.shouldInferEncoding){this.encoding=this.inferEncoding()}if(this.encoding==="array"){return arrayConcat(this.body)}if(this.encoding==="string"){return stringConcat(this.body)}if(this.encoding==="buffer"){return bufferConcat(this.body)}if(this.encoding==="uint8array"){return u8Concat(this.body)}return this.body};var isArray=Array.isArray||function(a){return Object.prototype.toString.call(a)=="[object Array]"};function isArrayish(a){return/Array\]$/.test(Object.prototype.toString.call(a))}function isBufferish(a){return typeof a==="string"||isArrayish(a)||(a&&typeof a.subarray==="function")}function stringConcat(e){var a=[];var c=false;for(var b=0;b<e.length;b++){var d=e[b];if(typeof d==="string"){a.push(d)}else{if(Buffer.isBuffer(d)){a.push(d)}else{if(isBufferish(d)){a.push(new Buffer(d))}else{a.push(new Buffer(String(d)))}}}}if(Buffer.isBuffer(e[0])){a=Buffer.concat(a);a=a.toString("utf8")}else{a=a.join("")}return a}function bufferConcat(d){var c=[];for(var a=0;a<d.length;a++){var b=d[a];if(Buffer.isBuffer(b)){c.push(b)}else{if(isBufferish(b)){c.push(new Buffer(b))}else{c.push(new Buffer(String(b)))}}}return Buffer.concat(c)}function arrayConcat(c){var b=[];for(var a=0;a<c.length;a++){b.push.apply(b,c[a])}return b}function u8Concat(f){var a=0;for(var e=0;e<f.length;e++){if(typeof f[e]==="string"){f[e]=new Buffer(f[e])}a+=f[e].length}var b=new U8(a);for(var e=0,g=0;e<f.length;e++){var d=f[e];for(var c=0;c<d.length;c++){b[g++]=d[c]}}return b};