"use strict";module.exports=preferredMediaTypes;module.exports.preferredMediaTypes=preferredMediaTypes;var simpleMediaTypeRegExp=/^\s*([^\s\/;]+)\/([^;\s]+)\s*(?:;(.*))?$/;function parseAccept(e){var d=splitMediaTypes(e);for(var c=0,b=0;c<d.length;c++){var a=parseMediaType(d[c].trim(),c);if(a){d[b++]=a}}d.length=b;return d}function parseMediaType(k,f){var g=simpleMediaTypeRegExp.exec(k);if(!g){return null}var c=Object.create(null);var a=1;var h=g[2];var l=g[1];if(g[3]){var m=splitParameters(g[3]).map(splitKeyValuePair);for(var e=0;e<m.length;e++){var d=m[e];var o=d[0].toLowerCase();var b=d[1];var n=b&&b[0]==='"'&&b[b.length-1]==='"'?b.substr(1,b.length-2):b;if(o==="q"){a=parseFloat(n);break}c[o]=n}}return{type:l,subtype:h,params:c,q:a,i:f}}function getMediaTypePriority(e,f,b){var d={o:-1,q:0,s:0};for(var c=0;c<f.length;c++){var a=specify(e,f[c],b);if(a&&(d.s-a.s||d.q-a.q||d.o-a.o)<0){d=a}}return d}function specify(d,a,b){var f=parseMediaType(d);var c=0;if(!f){return null}if(a.type.toLowerCase()==f.type.toLowerCase()){c|=4}else{if(a.type!="*"){return null}}if(a.subtype.toLowerCase()==f.subtype.toLowerCase()){c|=2}else{if(a.subtype!="*"){return null}}var e=Object.keys(a.params);if(e.length>0){if(e.every(function(g){return a.params[g]=="*"||(a.params[g]||"").toLowerCase()==(f.params[g]||"").toLowerCase()})){c|=1}else{return null}}return{i:b,o:a.i,q:a.q,s:c}}function preferredMediaTypes(d,a){var c=parseAccept(d===undefined?"*/*":d||"");if(!a){return c.filter(isQuality).sort(compareSpecs).map(getFullType)}var b=a.map(function f(h,g){return getMediaTypePriority(h,c,g)});return b.filter(isQuality).sort(compareSpecs).map(function e(g){return a[b.indexOf(g)]})}function compareSpecs(d,c){return(c.q-d.q)||(c.s-d.s)||(d.o-c.o)||(d.i-c.i)||0}function getFullType(a){return a.type+"/"+a.subtype}function isQuality(a){return a.q>0}function quoteCount(b){var c=0;var a=0;while((a=b.indexOf('"',a))!==-1){c++;a++}return c}function splitKeyValuePair(d){var a=d.indexOf("=");var b;var c;if(a===-1){b=d}else{b=d.substr(0,a);c=d.substr(a+1)}return[b,c]}function splitMediaTypes(d){var c=d.split(",");for(var b=1,a=0;b<c.length;b++){if(quoteCount(c[a])%2==0){c[++a]=c[b]}else{c[a]+=","+c[b]}}c.length=a+1;return c}function splitParameters(d){var c=d.split(";");for(var b=1,a=0;b<c.length;b++){if(quoteCount(c[a])%2==0){c[++a]=c[b]}else{c[a]+=";"+c[b]}}c.length=a+1;for(var b=0;b<c.length;b++){c[b]=c[b].trim()}return c};